define("bitbucket/internal/layout/maintenance","aui jquery bitbucket/util/navbuilder bitbucket/internal/util/ajax bitbucket/internal/widget/confirm-dialog bitbucket/internal/widget/progress-bar exports".split(" "),function(b,c,k,l,m,n,p){function q(c,d,a,b){if(d.task){if(d.task.state&&"RUNNING"!==d.task.state)return!0;c.update(d.task.progress);if(100===d.task.progress.percentage)return!0}}function r(c,d){var a=!1,b=l.poll({url:c.pollUrl,pollTimeout:Infinity,interval:500,statusCode:{404:function(){location.href=
c.redirectUrl;return!1},"*":function(){return!1}},tick:function(a,b,t){return c.pollTickCallback(d,a,b,t)}});b.cancel=function(){a=!0};b.isCancelled=function(){return a};return b}p.init=function(e){var d={pollUrl:b.contextPath()+"/system/maintenance",pollTickCallback:q,cancelTriggerSelector:".cancel-link",cancelFormSelector:".cancel-form",progressBarSelector:"#progress",redirectUrl:k.allProjects().build(),cancelButtonSelector:"#cancel",canceledHeader:b.I18n.getText("bitbucket.web.maintenance.canceled.title"),
cancelingButtonText:b.I18n.getText("bitbucket.web.maintenance.canceling.button"),cancelingDescription:b.I18n.getText("bitbucket.web.maintenance.canceling.description"),hasCancelDialog:!0,cancelDialogId:"cancel-maintenance-dialog",cancelDialogTitle:b.I18n.getText("bitbucket.web.maintenance.dialog.title"),cancelDialogTitleClass:"warning-header",cancelDialogDescription:b.I18n.getText("bitbucket.web.maintenance.dialog.description"),cancelDialogButtonText:b.I18n.getText("bitbucket.web.maintenance.dialog.cancel")},
a=c.extend({},d,e),h=c(a.cancelTriggerSelector);h.on("click",function(b){c(a.cancelFormSelector).addClass("visible");h.hide();b.preventDefault()});var f=n(a.progressBarSelector),g=r(a,f).done(function(c){location.href=a.redirectUrl});a.hasCancelDialog&&(e=new m({id:a.cancelDialogId,titleText:a.cancelDialogTitle,titleClass:a.cancelDialogTitleClass,panelContent:c("\x3cp\x3e\x3c/p\x3e").text(a.cancelDialogDescription),submitText:a.cancelDialogButtonText}),e.addCancelListener(function(){g.resume();f.active(!0)}),
e.addConfirmListener(function(b,d,e){g.cancel();e();d.val(a.cancelingButtonText).prop("disabled",!0).toggleClass("disabled",!0);f.update({message:a.cancelingDescription,percentage:100});f.reversed(!0);f.active(!0);c("#backup-description").hide();c("#content \x3e header \x3e h1").text(a.canceledHeader)}),e.attachTo(a.cancelButtonSelector,function(){g.pause();f.active(!1)}),c(a.cancelFormSelector).find('input[name\x3d"token"]').each(function(){var b=c(this),d=c(a.cancelButtonSelector);d.prop("disabled",
!c.trim(b.val()));b.on("input",function(){d.prop("disabled",!c.trim(b.val()))})}))}});