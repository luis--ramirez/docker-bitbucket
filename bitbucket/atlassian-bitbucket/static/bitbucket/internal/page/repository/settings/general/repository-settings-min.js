define("bitbucket/internal/page/repositoryGeneralSettings","aui jquery lodash bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/feature/project/project-selector bitbucket/internal/feature/repository/branch-selector bitbucket/internal/feature/repository/cloneUrlGen bitbucket/internal/model/page-state bitbucket/internal/util/error bitbucket/internal/util/notifications bitbucket/internal/widget/confirm-dialog exports".split(" "),function(e,d,q,h,k,r,t,n,f,p,l,u,v){function w(){function b(){var b=
d("#moveName").val(),c=g.getSelectedItem().toJSON();b===f.getRepository().getName()&&c.key===f.getProject().getKey()?a.hide():k.rest({type:"PUT",url:h.rest().currentRepo().build(),data:{name:b,project:c},statusCode:{400:!1,409:!1}}).done(function(a){l.addFlash(a.project.key===f.getProject().getKey()?e.I18n.getText("bitbucket.web.repository.rename.success",f.getRepository().getName(),a.name):e.I18n.getText("bitbucket.web.repository.move.success",a.name,a.project.name));location.href=h.project(a.project.key).repo(a.slug).settings().build()}).fail(function(b,
c,d,e){p.setFormErrors(a.popup.element.find("form.aui"),q.chain(e.errors).filter(function(a){return"slug"!==a.context}).map(function(a){var b=a.context;if("project"===b||"name"===b)a.context="move"+b.charAt(0).toUpperCase()+b.slice(1);return a}).value());a.updateHeight()})}var a=new e.Dialog({id:"repository-move-dialog"}),c=bitbucket.internal.page.moveRepositoryForm({repository:f.getRepository().toJSON()});a.addHeader(e.I18n.getText("bitbucket.web.repository.move.title"));a.addPanel("",c);var c=d("#moveProjectSelector"),
g=new r(c,{field:c.next("input")}),m=d("#moveName"),x=d(".clone-url-generated span");n.bindUrlGeneration(x,{elementsToWatch:[m,c],getProject:g.getSelectedItem.bind(g),getRepoName:m.val.bind(m)});a.addButton(e.I18n.getText("bitbucket.web.button.move"),b,"button");a.popup.element.find("form.aui").on("submit",function(a){a.preventDefault();b()});a.addCancel(e.I18n.getText("bitbucket.web.button.cancel"),function(){g.dialog.hide();a.hide()});return a}function y(b){var a;d(b).on("click",function(b){b.preventDefault();
a||(a=w());a.show();p.clearFormErrors(a.popup.element);a.updateHeight()})}function z(b){var a=f.getRepository().toJSON(),c=new u({id:"delete-repository-dialog",titleText:e.I18n.getText("bitbucket.web.repository.delete.title"),titleClass:"warning-header",panelContent:bitbucket.internal.page.deleteRepositoryDialog({repository:a}),submitText:e.I18n.getText("bitbucket.web.button.delete"),height:240},{type:"DELETE"});c.attachTo(b);c.addConfirmListener(function(c){c.then(function(c,f,g){return k.poll({url:d(b).attr("href"),
statusCode:{404:function(){l.addFlash(e.I18n.getText("bitbucket.web.repository.deleted",a.name));window.location=h.currentProject().build();return!1}}})})})}function A(b){var a=b.find(".size-load-button");a.click(function(c){c.preventDefault();a.remove();B(b)})}function B(b){var a=b.find(".spinner").spin();k.rest({type:"GET",url:h.currentRepo().sizes().build(),statusCode:{"*":!1}}).always(function(){a.remove()}).done(function(a){b.html(bitbucket.internal.page.repositorySizeDisplay(a))}).fail(function(){var a=
bitbucket.internal.page.repositoryInlineError({message:e.I18n.getText("bitbucket.web.repository.size.error")});d(a).insertAfter(b)})}v.onReady=function(b,a,c){l.showFlashes();y(a);z(c);A(d(b).find(".field-group #size"));new t(d("#default-branch"),{field:d("#default-branch-field")});b=d("#name");a=d(".clone-url-generated span");n.bindUrlGeneration(a,{elementsToWatch:[b],getRepoName:b.val.bind(b)})}});