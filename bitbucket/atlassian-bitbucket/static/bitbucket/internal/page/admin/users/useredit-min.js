define("bitbucket/internal/page/admin/userEdit","aui aui/flag jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/user-groups-table bitbucket/internal/util/ajax bitbucket/internal/util/error bitbucket/internal/util/notifications bitbucket/internal/widget/confirm-dialog bitbucket/internal/widget/delete-dialog bitbucket/internal/widget/submit-spinner bitbucket/internal/widget/user-avatar-form exports".split(" "),function(d,w,a,l,r,x,m,t,p,y,z,u,A,B){function k(a,e){w({type:e||"info",
title:a,close:"auto"})}function v(d,e){a(d).parent(".field-group").append(a("\x3cspan class\x3d'error'\x3e\x3c/span\x3e").text(e))}function q(){a(".panel-details .error, .content-body .notifications \x3e .error").remove()}function n(a){l.isArray(a)?l.each(a,function(a){a.message&&a.context&&"email"===a.context?v("#email",a.message):a.message&&a.context&&"displayName"===a.context?v("#fullname",a.message):a.message?k(a.message,"error"):k(a,"error")}):l.isString(a)&&k(a,"error")}function C(g){z.bind(g,
d.I18n.getText("bitbucket.web.user.delete"),d.I18n.getText("bitbucket.web.user.delete.success"),d.I18n.getText("bitbucket.web.user.delete.fail"),function(a){p.addFlash(d.I18n.getText("bitbucket.web.user.delete.success",a));window.location=r.admin().users().build();return!1},function(){return a("#fullname").val()})}function D(g){var e=a(bitbucket.internal.admin.users.clearCaptchaDialog({displayName:a("#fullname").val()})),f=new y({id:"clear-captcha-dialog",titleText:d.I18n.getText("bitbucket.web.user.captcha.clear"),
panelContent:e,submitText:d.I18n.getText("bitbucket.web.button.clear")},{type:"DELETE"});f.attachTo(g);f.addConfirmListener(function(b){b.done(function(){a(g).remove();f.destroy();var b=d.I18n.getText("bitbucket.web.user.captcha.cleared");k(b,"success")})})}function E(g,e){a(e).click(function(e){e.preventDefault();var b=a(bitbucket.internal.admin.users.passwordResetForm({})),c=new d.Dialog({width:433,id:"change-password-dialog",closeOnOutsideClick:!1,keypressListener:function(b){b.stopImmediatePropagation();
b.keyCode===d.keyCode.ENTER?(b.preventDefault(),a(this).find(".button-panel-submit-button").click()):b.keyCode===d.keyCode.ESCAPE&&(b.preventDefault(),c.remove())}});c.addHeader(d.escapeHtml(d.I18n.getText("bitbucket.web.user.change.password.dialog",g.name)));c.addPanel("content",b);c.addSubmit(d.I18n.getText("bitbucket.web.button.save"),function(c){var e=(new u(a(c.getPage(0).buttonpanel).find(".button-panel-submit-button"),"before")).show();c.disable();var f=c.getPage(0).buttonpanel;f.addClass("disabled");
m.rest({url:b.attr("action"),type:"PUT",data:l.extend({name:g.name},m.formToJSON(b)),statusCode:{"*":function(){return!1}}}).always(function(){e.remove()}).done(function(){c.remove();var a=d.I18n.getText("bitbucket.web.user.password.update.success");k(a,"success")}).fail(function(a,e,g,h){c.enable();f.removeClass("disabled");t.setFormErrors(b,h&&h.errors&&h.errors[0]&&h.errors[0].message?h.errors:[{message:d.I18n.getText("bitbucket.web.user.change.password.failure")}]);c.updateHeight()})});c.addCancel(d.I18n.getText("bitbucket.web.button.cancel"),
function(a){a.remove()});c.show();c.updateHeight()})}function F(g,e){a(e).click(function(e){e.preventDefault();var b=a(bitbucket.internal.admin.users.renameUserForm({})),c=new d.Dialog({width:433,id:"rename-user-dialog",closeOnOutsideClick:!1,keypressListener:function(b){b.stopImmediatePropagation();b.keyCode===d.keyCode.ENTER?(b.preventDefault(),a(this).find(".button-panel-submit-button").click()):b.keyCode===d.keyCode.ESCAPE&&(b.preventDefault(),c.remove())}});c.addHeader(d.I18n.getText("bitbucket.web.user.rename.user.dialog",
g.name));c.addPanel("content",b);c.addSubmit(d.I18n.getText("bitbucket.web.button.save"),function(c){var e=(new u(a(".button-panel-submit-button",c.getPage(0).buttonpanel),"before")).show();c.disable();var f=c.getPage(0).buttonpanel;f.addClass("disabled");m.rest({url:b.attr("action"),type:"POST",data:l.extend({name:g.name},m.formToJSON(b)),statusCode:{"*":function(){return!1}}}).always(function(){e.remove()}).done(function(a){p.addFlash(d.I18n.getText("bitbucket.web.user.rename.success"));location.href=
r.admin().users().view(a.name).build()}).fail(function(a,e,g,h){c.enable();f.removeClass("disabled");t.setFormErrors(b,h&&h.errors&&h.errors[0]&&h.errors[0].message?h.errors:[{message:d.I18n.getText("bitbucket.web.user.rename.failure")}]);c.updateHeight()})});c.addCancel(d.I18n.getText("bitbucket.web.button.cancel"),function(a){a.remove()});c.show();c.updateHeight()})}function G(){function g(b){b.find("input[type\x3dtext]").each(function(){var b=a(this);b.val(b.data("rollback"))})}function e(b,c){b.find("#fullname").val(c.displayName);
b.find("#email").val(c.emailAddress);b.find("input[type\x3dtext]").each(function(){var b=a(this);b.data("rollback",b.val())})}function f(b){b.removeClass("editing").find("#fullname, #email").attr("readonly","readonly");a("#ajax-status-message").empty();q()}a("#edit-details").click(function(b){a(".panel-details form.editable").addClass("editing").find("#fullname, #email").removeAttr("readonly");"email"!==b.target.id&&a("#fullname",".panel-details form.editable").focus();b.preventDefault()});a(".panel-details form.editable").keyup(function(b){b.which===
d.keyCode.ESCAPE&&a("a.cancel",this).click()});a(".cancel",".panel-details form.editable").click(function(b){b.preventDefault();b=a(this).parents("form");g(b);f(b);return!1});a(".panel-details form.editable").submit(function(b){b.preventDefault();q();var c=a(this),g=c.find("#fullname").val();m.rest({url:c.attr("action"),type:"PUT",data:{name:c.find("#name").val(),displayName:g,email:c.find("#email").val()},statusCode:{500:function(){return!1},404:function(){return!1},401:function(){return!1},400:function(){return!1}}}).done(function(a){e(c,
a);f(c);a=d.I18n.getText("bitbucket.web.user.update.success",g);k(a,"success")}).fail(function(a,b,c,e){a=e&&e.errors?e.errors:d.I18n.getText("bitbucket.web.user.update.failure");n(a)})})}B.onReady=function(d,e){p.showFlashes();C(e.deleteLinkSelector);D(e.clearCaptchaLinkSelector);E(d,e.passwordLinkSelector);F(d,e.renameUserLinkSelector);G();var f=e.avatarFormSelector,b={name:"atl_token",value:a(".user-details-form input[name\x3datl_token]").val()},f=new A(a(f),d,b);f.on("avatarChanged",q);f.on("avatarUploadError",
n);f.on("avatarDeleteError",n);(new x({target:e.groupsTableSelector,onError:n})).init()}});