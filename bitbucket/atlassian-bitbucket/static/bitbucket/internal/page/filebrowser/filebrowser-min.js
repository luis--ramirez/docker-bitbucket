define("bitbucket/internal/page/filebrowser","aui jquery lodash bitbucket/internal/feature/filebrowser/file-finder bitbucket/internal/feature/filebrowser/file-table bitbucket/internal/model/content-tree-node-types bitbucket/internal/model/path bitbucket/internal/model/revision-reference bitbucket/internal/util/events exports".split(" "),function(d,e,A,B,v,f,q,w,a,C){function D(){return x.find(".file-row a").map(function(a,c){var b=e(c),m=b.parent().parent();return{name:b.text(),contentId:b.attr("data-contentId"),
type:m.hasClass("file")?f.FILE:m.hasClass("directory")?f.DIRECTORY:f.SUBMODULE}}).toArray()}function E(){var r={focusedClass:"focused-file",wrapAround:!1,escToCancel:!1},c="#browse-table tr.file-row."+r.focusedClass;a.on("bitbucket.internal.keyboard.shortcuts.requestMoveToNextHandler",function(a){(this.moveToNextItem?this:d.whenIType(a)).moveToNextItem("#browse-table tr.file-row",r)});a.on("bitbucket.internal.keyboard.shortcuts.requestMoveToPreviousHandler",function(a){(this.moveToPrevItem?this:d.whenIType(a)).moveToPrevItem("#browse-table tr.file-row",
r)});a.on("bitbucket.internal.keyboard.shortcuts.requestOpenItemHandler",function(b){(this.execute?this:d.whenIType(b)).execute(function(){if(!n){var b=e(c);b.length&&(b.hasClass("file")?(a.trigger("bitbucket.internal.feature.filetable.showSpinner",this),window.location.href=b.find("a").attr("href")):b.find("a").click())}})});a.on("bitbucket.internal.keyboard.shortcuts.requestOpenParentHandler",function(a){(this.execute?this:d.whenIType(a)).execute(function(){if(!n){var a=e(t.getParentDirSelector());
a.length&&a.click()}})});a.on("bitbucket.internal.keyboard.shortcuts.requestOpenFileFinderHandler",function(b){y=d.I18n.getText("bitbucket.web.file.finder.findfiles.tooltip",b);h.attr("title",y).tooltip({gravity:"ne"});(this.execute?this:d.whenIType(b)).execute(function(){a.trigger("bitbucket.internal.feature.filetable.showFind",this)})});a.on("bitbucket.internal.keyboard.shortcuts.requestCloseFileFinderHandler",function(b){z=d.I18n.getText("bitbucket.web.file.finder.browse.files.tooltip",b);k.attr("title",
z).tooltip();(this.execute?this:d.whenIType(b)).execute(function(){a.trigger("bitbucket.internal.feature.filetable.hideFind",this)})})}var F=v.FileTable,G=v.FileTableView,H=B.FileFinder,n,p,t,l,y,z,u,x,h,k;C.onReady=function(d,c,b,m){var f=new q(d),g=new w(c);u=e(".find-files");x=e(".filebrowser-content");h=u.find(".find-files-button");k=u.find(".browse-files-button");t=new G(b);p=new F(f,g,m);l=new H(b,g);e(document).on("focus","#browse-table tr.file-row",function(){e(".focused-file").removeClass("focused-file");
e(this).addClass("focused-file")});a.on("bitbucket.internal.history.popstate",function(a){a.state&&(g=new w(a.state.revisionRef))});c=function(b){g!==b&&(g=b,a.trigger("bitbucket.internal.page.filebrowser.revisionRefChanged",null,b))};a.on("bitbucket.internal.layout.branch.revisionRefChanged",c);a.on("bitbucket.internal.feature.filetable.revisionRefChanged",c);a.on("bitbucket.internal.widget.branchselector.dialogShown",function(){n=!0});a.on("bitbucket.internal.widget.branchselector.dialogHidden",
function(){n=!1});c=function(b){a.trigger("bitbucket.internal.page.filebrowser.urlChanged",null,b)};a.on("bitbucket.internal.layout.*.urlChanged",c);a.on("bitbucket.internal.feature.*.urlChanged",c);a.on("bitbucket.internal.feature.*.pathChanged",function(b){f=new q(b);a.trigger("bitbucket.internal.page.filebrowser.pathChanged",null,f.toJSON())});a.on("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",function(a){a.enableContext("filebrowser")});c=function(){l.isLoaded()&&(h.attr("aria-pressed",
!1),k.attr("aria-pressed",!0),l.unloadFinder(),p.data?t.update(p.data):p.reload())};a.on("bitbucket.internal.feature.filetable.showFind",function(){l.isLoaded()||(h.attr("aria-pressed",!0),k.attr("aria-pressed",!1),l.loadFinder())});a.on("bitbucket.internal.feature.filetable.hideFind",c);a.on("bitbucket.internal.page.filebrowser.revisionRefChanged",c);a.trigger("bitbucket.internal.feature.filebrowser.filesChanged",null,{files:D(),path:(new q(d)).toJSON(),revision:g.getId()});a.on("bitbucket.internal.feature.filetable.dataReceived",
function(b){b&&b.children&&a.trigger("bitbucket.internal.feature.filebrowser.filesChanged",null,{files:b.children.values.map(function(a){return A.pick(a,"name","contentId","type")}),path:b.path,revision:b.revisionRef&&b.revisionRef.id})});h.click(function(){a.trigger("bitbucket.internal.feature.filetable.showFind");return!1});k.click(function(){a.trigger("bitbucket.internal.feature.filetable.hideFind");return!1});E()}});