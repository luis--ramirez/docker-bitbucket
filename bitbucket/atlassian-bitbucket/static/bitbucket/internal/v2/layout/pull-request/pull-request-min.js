var _react=require("react"),_react2=babelHelpers.interopRequireDefault(_react);
define("bitbucket/internal/v2/layout/pull-request","aui chaperone jquery lodash react react-dom react-redux bitbucket/util/events bitbucket/util/navbuilder bitbucket/util/state bitbucket/internal/bbui/actions/pull-request bitbucket/internal/model-transformer bitbucket/internal/model/page-state bitbucket/internal/model/pull-request bitbucket/internal/model/revision bitbucket/internal/util/dom-event bitbucket/internal/util/events bitbucket/internal/util/feature-loader bitbucket/internal/util/history bitbucket/internal/util/horizontal-keyboard-scrolling bitbucket/internal/v2/feature/pull-request/analytics bitbucket/internal/v2/feature/pull-request/header/pull-request-header-view bitbucket/internal/v2/feature/pull-request/store/pull-request-store exports".split(" "),function(c,
n,k,p,r,A,B,C,q,t,D,u,g,E,v,F,b,w,G,x,H,I,J,y){function K(){b.on("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",function(a){a.enableContext("pull-request");z.resolve(a)});b.on("bitbucket.internal.keyboard.shortcuts.requestGotoPullRequestsListHandler",function(a){(this.execute?this:c.whenIType(a)).execute(function(){window.location.href=q.currentRepo().allPullRequests().build()})});b.on("bitbucket.internal.keyboard.shortcuts.requestChangePullRequestSectionHandler",function(a){(this.execute?
this:c.whenIType(a)).execute(function(a){a=parseInt(String.fromCharCode(a.which),10);l.children().eq(a-1).children("a").click()})})}function L(){function a(a){a.addClass("active-tab").siblings().removeClass("active-tab")}function e(a,f){var b=a?q.currentRepo().pullRequest(f).commit(a.id).build():q.currentRepo().pullRequest(f).diff().build();l.find('.menu-item[data-module-key\x3d"bitbucket.pull-request.nav.diff"] \x3e a').attr("href",b)}l.on("click","a",function(d){if(F.openInSameTab(d)){var f=k(this),
c=f.parent();c.is(".active-tab")||(a(c),b.trigger("bitbucket.internal.layout.pull-request.urlRequested",null,f.prop("href")),f=c.data("module-key").split(".").pop(),b.trigger("bitbucket.internal.feature.pullRequest.tab."+f,null,{keyboard:!(d.originalEvent instanceof MouseEvent)}));d.preventDefault()}});b.on("bitbucket.internal.page.pull-request.view.contextLoaded",function(d){a(l.find('[data-module-key\x3d"'+d.name+'"]'));d.name===m.diff?x.resume():x.pause()});b.on("bitbucket.internal.feature.commitselector.commitSelected",
function(a,f){g.setCommit(a?new v(a):null);e(a,f)});z.done(function(a){p.each(l.children(),function(f,b){var e=k(f),g=String(b+1),h=c.I18n.getText("bitbucket.web.keyboardshortcut.pull-request.switch.tabs",e.text());a.addCustomShortcut("pull-request",[[g]],h);e.attr("title",(e.attr("title")||h)+c.I18n.getText("bitbucket.web.keyboardshortcut.type",g))})});e(t.getCommit(),t.getPullRequest())}function M(a,c){function d(a,b){var c=p.findKey(m,p.matches(b));c&&C.trigger("bitbucket.internal.browser-metrics.pull-request."+
c+"."+a)}h.registerHandler(m.diff,/^[^\?\#]*pull-requests\/\d+\/(diff|commits\/\b[0-9a-fA-F]{5,40}\b)/,"bitbucket/internal/page/pull-request/view/pull-request-view-diff");h.registerHandler(m.overview,/^[^\?\#]*pull-requests\/\d+\/overview/,"bitbucket/internal/v2/page/pull-request/view/pull-request-view-overview");h.registerHandler(m.commits,/^[^\?\#]*pull-requests\/\d+\/commits(\/?)($|[#?])/,"bitbucket/internal/page/pull-request/view/pull-request-view-commits");b.on("bitbucket.internal.page.pull-request.view.contextRequested",
d.bind(null,"start"));b.on("bitbucket.internal.page.pull-request.view.contextLoaded",function(a){d("end",a.name)});b.on("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",function(a){h.setKeyboardShortcuts(a);a.enableContext("pull-request")});b.on("bitbucket.internal.layout.pull-request.urlRequested",function(a){a!==window.location.href&&G.pushState(null,"",a)});b.on("bitbucket.internal.util.feature-loader.errorOccurred",function(a){a.code===w.NO_HANDLER?console.log("You did not register a handler for this page. Please call\nrequire('bitbucket/internal/layout/pull-request').registerHandler(\n   'tab-web-item-module-key',\n   /^[^\\?\\#]*url-regex/,\n   {\n       load : function (contentElement) {},\n       unload : function (contentElement) {}\n   }\n)"):
console.log(a.message)});c.done(function(b){h.init(k(a).get(0))})}var m={diff:"bitbucket.pull-request.nav.diff",overview:"bitbucket.pull-request.nav.overview",commits:"bitbucket.pull-request.nav.commits"},l,z=k.Deferred(),h=new w({loadedEvent:"bitbucket.internal.page.pull-request.view.contextLoaded",unloadedEvent:"bitbucket.internal.page.pull-request.page.pull-request.view.contextUnloaded",requestedEvent:"bitbucket.internal.page.pull-request.view.contextRequested"});y.registerHandler=k.proxy(h.registerHandler,
h);y.onReady=function(a){g.setPullRequest(new E(a.pullRequestJSON));a.commitJSON&&g.setCommit(new v(a.commitJSON));g.extend("pullRequestViewInternal",function(){return{commitsTableWebSections:a.commitsTableWebSections,maxChanges:a.maxChanges,relevantContextLines:a.relevantContextLines,seenCommitReview:a.seenCommitReview}});g.extend("isWatching");var e=J();e.dispatch({type:"PR_SET_PULL_REQUEST",payload:u.pullRequest(a.pullRequestJSON)});e.dispatch({type:"SET_CURRENT_USER",payload:u.user(g.getCurrentUser().toJSON())});
A.render(r.createElement(B.Provider,{store:e},r.createElement(I,{hasRepoWrite:a.hasRepoWrite,mergeTimeout:a.mergeTimeout})),document.getElementById("pull-request-header"));l=k(".content-body .aui-page-panel-content \x3e .aui-tabs \x3e .tabs-menu");var d=k.Deferred();_PageDataPlugin.ready("com.atlassian.bitbucket.server.bitbucket-web:iswatching-provider","bitbucket.internal.pull-request.view",function(a){e.dispatch({type:D.PR_SET_IS_WATCHING,payload:a.isWatching});g.setIsWatching(a.isWatching);d.resolve()});
!0!==a.seenNeedsWork&&(n.registerFeature("reviewer-status",[{id:"reviewer-status",alignment:"top right",selector:".reviewing.reviewer-status-selector",content:bitbucket.internal.feature.pullRequest.feature.discovery.reviewerStatus(),close:{text:c.I18n.getText("bitbucket.web.got.it")},moreInfo:{href:bitbucket_help_url("bitbucket.help.pull.request"),text:c.I18n.getText("bitbucket.web.pullrequest.learn.more"),extraAttributes:{target:"_blank"}},once:!0}]),b.on("bitbucket.internal.feature.pullRequest.self.added",
n.checkFeatureVisibility));k(document).on("click","button.needs-work",function(){n.registerFeature("needs-work-click",[{id:"needs-work-click",selector:"button.needs-work",alignment:"bottom center",title:c.I18n.getText("bitbucket.web.pullrequest.reviewer.status.feature.discovery.needs.work.click.title"),content:bitbucket.internal.feature.pullRequest.feature.discovery.reviewerStatusClick(),close:{text:c.I18n.getText("bitbucket.web.got.it")},moreInfo:{href:bitbucket_help_url("bitbucket.help.pull.request"),
text:c.I18n.getText("bitbucket.web.pullrequest.learn.more"),extraAttributes:{target:"_blank"}},width:340,once:!0}])});H.init();K();L();M(a.contentSelector,d)}});