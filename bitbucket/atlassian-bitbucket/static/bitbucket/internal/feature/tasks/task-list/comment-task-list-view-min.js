define("bitbucket/internal/feature/tasks/task-list/comment-task-list-view","backbone lodash bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/task-list/task-list-row-view bitbucket/internal/feature/tasks/task-view bitbucket/internal/util/events bitbucket/internal/util/feature-detect bitbucket/internal/util/function".split(" "),function(m,f,d,n,h,p,k,q){return m.View.extend({defaults:{pullRequestId:null},initialize:function(a){var b=this;this.comment=a.comment;["add","remove"].forEach(function(a){b.listenTo(b.collection,
a,b.render.bind(b,a))});this.options=f.extend({},this.defaults,a);this.taskRowViews=[]},getCurrentTask:function(){return this.collection.find(q.invoke("isNew"))},getCurrentTaskText:function(){return this.getCurrentTaskRowView().getEditorText()||""},getCurrentTaskRowView:function(){return this._findRowViewForTask(this.getCurrentTask())},createTask:function(a){var b=this.getCurrentTaskRowView();if(b)return b.focusEditor(),null;b=new d({anchor:{id:this.comment.id,type:d.Anchor.COMMENT},pullRequestId:this.options.pullRequestId,
repositoryId:this.options.repositoryId,text:a});this.collection.unshift(b);a&&(b.prefilled=!0,b.save().fail(this.collection.remove.bind(this.collection,b)));return b},render:function(a,b,c,e){function d(a){return new n({model:a,initialTaskViewMode:a.isNew()&&""===a.getText()?h.Mode.EDIT:h.Mode.VIEW,isCollapsible:!1,showLink:!1})}function l(a){g.$el.removeClass("transition-height").css({height:"auto"});a&&p.trigger("bitbucket.internal.webpanel.resize",null,{location:"bitbucket.comments.extra",el:g.$el.get(0)})}
var g=this;this.$(".pending-delete").removeClass("pending-delete");c=this.$el.outerHeight(!0);this.$el.css({height:c});c=!1;switch(a){case "remove":if(a=this._findRowViewForTask(b))a.$el.addClass("pending-delete").trigger("comment-child-removed"),a.remove(),this.taskRowViews=f.without(this.taskRowViews,a);c=!0;break;case "add":c=e.at;a=d(b);this.taskRowViews.splice(c,0,a);e=a.render().$el;c=this.$(this.$("li").get(c));c.length?c.before(e):this.$el.append(e);b.isNew()&&""!==b.getText()&&a.highlight();
e.trigger("comment-child-added");c=!0;break;default:f.invoke(this.taskRowViews,"remove"),this.taskRowViews=this.collection.map(d),this.$el.append(this.taskRowViews.map(function(a){return a.render().$el}))}b=this.taskRowViews.reduce(function(a,b){return a+b.$el.outerHeight(!0)},0);if(k.cssTransition()&&c)this.$el.addClass("transition-height").css({height:b}).one(k.transitionEndEventName(),l.bind(g,!0));else l(!1);return this},_findRowViewForTask:function(a){return f.find(this.taskRowViews,{model:a})}})});