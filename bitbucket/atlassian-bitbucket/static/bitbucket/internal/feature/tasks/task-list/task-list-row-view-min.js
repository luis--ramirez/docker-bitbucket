define("bitbucket/internal/feature/tasks/task-list/task-list-row-view","backbone jquery lodash bitbucket/util/events bitbucket/internal/feature/tasks/model/task-state bitbucket/internal/feature/tasks/task-view bitbucket/internal/util/feature-detect bitbucket/internal/util/function".split(" "),function(l,h,c,d,k,e,g,m){return l.View.extend({events:{"click .task-content":"taskListContentClicked","click .task-link-button":"taskListLinkClicked","click .comment-diff-anchor .aui-button":"taskListDiffAnchorClicked"},
defaults:{isCollapsible:!0,showLink:!0,initialTaskViewMode:e.Mode.VIEW},initialize:function(a){this.options=c.extend({},this.defaults,a);this.isCollapsed=this.options.isCollapsible;this.taskView=new e({model:this.model,mode:this.options.initialTaskViewMode,prNavBuilder:this.prNavBuilder,showLink:this.options.showLink});this.focusEditor=this.taskView.focusEditor;this.getEditorText=this.taskView.getEditorText;this.listenTo(this.model,"change:state",this._handleTaskChangeState);this.listenTo(this.model,
"change:text",this._handleTaskChangeText);this.options.isCollapsible&&(c.bindAll(this,"handleTaskExpand"),d.on("bitbucket.internal.feature.tasks.list.expand",this.handleTaskExpand))},template:m.dot("bitbucket.internal.feature.tasks.taskList.taskListRow")(window),activityUrl:function(){var a=this.model.getAnchor();return this.options.prNavBuilder.overview().comment(a.id).build()},diffUrl:function(a){return this.options.prNavBuilder.diff().change(a).build()},render:function(){var a=h(this.template({isCollapsed:this.isCollapsed}));
a.append(this.taskView.render().$el);this.$el.replaceWith(a);this.setElement(a);return this},transitionTaskHandler:function(){this.model.transitionToNextState()},taskListContentClicked:function(a){this.options.isCollapsible&&(h(a.target).is("a")||this.setCollapsed(!this.isCollapsed))},setCollapsed:function(a){function b(a,b,c,d){function e(){f.$el.removeClass([b,d].join(" ")).addClass(c).css({height:""})}f.$el.css({height:a}).addClass(b);if(g.cssTransition())f.$el.one(g.transitionEndEventName(),e);
else e()}var f=this;(this.isCollapsed=a)?(this.$el.css({height:f.$el.find(".task").get(0).scrollHeight}).removeClass("expanded"),c.defer(b.bind(this,"","collapsing","collapsed","expanded expanding"))):this.model.getState()===k.OPEN&&(d.trigger("bitbucket.internal.feature.tasks.list.expand",null,this),this.$el.removeClass("collapsed"),b(f.$el.find(".task").get(0).scrollHeight,"expanding","expanded","collapsed collapsing"))},taskListDiffAnchorClicked:function(a){var b=this.model.getProperties().diffAnchorPath;
this._handleTaskClick(a,"bitbucket.internal.layout.pull-request.urlRequested",this.diffUrl(b));this.triggerTaskVisitedEvent({location:"diff"})},taskListLinkClicked:function(a){this._handleTaskClick(a,"bitbucket.internal.layout.pull-request.urlRequested",this.activityUrl());this.triggerTaskVisitedEvent({location:"activity-stream"})},triggerTaskVisitedEvent:function(a){a=c.extend({},{task:this.model.toJSON()},a);d.trigger("bitbucket.internal.feature.tasks.visit-task",null,a)},handleTaskExpand:function(a){a===
this||this.isCollapsed||(this.taskView.mode===e.Mode.EDIT&&this.taskView.cancelTaskEdit(),this.setCollapsed(!0))},highlight:function(){var a=this.$el.removeClass.bind(this.$el,"task-highlight");this.$el.addClass("task-highlight");if(g.cssAnimation())this.$el.one(g.animationEndEventName(),a);else setTimeout(a,5E3)},_handleTaskClick:function(a,b){a.preventDefault();d.trigger.apply(this,[b,null].concat(c.toArray(arguments).slice(2)))},_handleTaskChangeState:function(a){this.$el.toggleClass("pending-delete",
a.getState()===k.DELETED)},_handleTaskChangeText:function(a){a.isNew()&&""!==a.getText()&&this.highlight()}})});