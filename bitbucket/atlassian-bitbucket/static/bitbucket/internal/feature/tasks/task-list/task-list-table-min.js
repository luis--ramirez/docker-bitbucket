define("bitbucket/internal/feature/tasks/task-list/task-list-table","aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/model/task-state bitbucket/internal/feature/tasks/task-list/task-list-row-view bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/widget/paged-table".split(" "),function(n,k,d,l,p,g,q,m,h,e){function a(c,a,b,f){var r=this;this._scrollable=k(a);this.$target=k(c);this.collection=b;
this.context=f;this._destroyables=[];this._resolvedHeaderOutput=!1;d.bindAll(this,"_onTaskDestroy","_handleEdit","_handleMoveNext","_handleMovePrevious","_handleOpen","_handleTransitionToNextState","_handleDelete");this.collection.on("destroy",this._onTaskDestroy);this._taskRowViews=[];e.call(this,{target:this.$target,noneFoundMessageHtml:bitbucket.internal.feature.tasks.taskList.dialogEmptyMessage,scrollPaneSelector:a,rowSelector:"\x3e li",taskContainerSelector:".task-container",paginationContext:"task-list",
focusOptions:{rowSelector:"\x3e li",focusedClass:"focused"},statusCode:{"*":function(c,a,b,t,d){return"timeout"===b||500<=c.status&&599>=c.status?(bitbucket.internal.widget.paragraph({text:d.message}),r._addNoRowsMessage(d.message),!1):!0}}});this.prNavBuilder=l.project(f.projectKey).repo(f.repository).pullRequest(f.pullRequestId);this.bindNavigationHandlers()}d.extend(a.prototype,e.prototype);m.addLocalEventMixin(a.prototype);a.prototype._addNoRowsMessage=function(c){this.$table.addClass("no-rows").after(this._new$Message(c||
this.options.noneFoundMessageHtml()))};a.prototype.update=function(c){this._resolvedHeaderOutput=!1;d.invoke(this._taskRowViews,"remove");this._taskRowViews=[];e.prototype.update.call(this,c).done(this.trigger.bind(this,"dataLoaded"))};a.prototype.buildUrl=function(c,a){return l.rest().project(this.context.projectKey).repo(this.context.repository).pullRequest(this.context.pullRequestId).addPathComponents("tasks").withParams({start:c,limit:a,withComments:!0}).build()};a.prototype.handleNewRows=function(c,
a){var b=this,f=[];d.each(c.values,function(c){var a=b.collection.get(c.id);a?a.set(c):(a=new p(c),a.setPullRequestId(b.context.pullRequestId),b.collection.add(a));c=new q({prNavBuilder:b.prNavBuilder,model:a});b._taskRowViews.push(c);a.getState()!==g.RESOLVED||b._resolvedHeaderOutput||(a=bitbucket.internal.feature.tasks.taskList.dialogContentSection({title:n.I18n.getText("bitbucket.web.tasks.dialog.resolved.subtitle")}),f.push(a),b._resolvedHeaderOutput=!0);f.push(c.render().$el)});b.$table.show()["html"!==
a?a:"append"](f)};a.prototype.bindNavigationHandlers=function(){this._destroyables.push(m.chain().on("bitbucket.internal.feature.tasks.dialog.action.edit",this._handleEdit).on("bitbucket.internal.feature.tasks.dialog.action.moveNext",this._handleMoveNext).on("bitbucket.internal.feature.tasks.dialog.action.movePrevious",this._handleMovePrevious).on("bitbucket.internal.feature.tasks.dialog.action.open",this._handleOpen).on("bitbucket.internal.feature.tasks.dialog.action.transitionToNextState",this._handleTransitionToNextState).on("bitbucket.internal.feature.tasks.dialog.action.delete",
this._handleDelete));this._destroyables.push(e.prototype.initShortcuts.call(this))};a.prototype.destroy=function(){e.prototype.destroy.call(this);d.invoke(this._destroyables,"destroy")};a.prototype.getTaskListRowViewForTask=function(a){var d=this._taskRowViews.filter(function(b){return b.model.getId()===a.getId()});return d&&d[0]};a.prototype.focusInitialRow=function(){this._$focusedRow=this.$target.find(this.options.focusOptions.rowSelector+this.options.taskContainerSelector).first().addClass(this.options.focusOptions.focusedClass)};
a.prototype.scrollToRow=function(a){var d=this._scrollable.offset().top,b=this._scrollable.scrollTop();a=a.offset().top;this._scrollable.scrollTop(a-d+b)};a.prototype._handleMoveNext=function(){this._focusRow("nextAll")};a.prototype._handleMovePrevious=function(){this._focusRow("prevAll")};a.prototype._focusRow=function(a,d){var b=this._$focusedRow[a](this.options.taskContainerSelector);b.length&&(this._$focusedRow.removeClass(this.options.focusOptions.focusedClass),this._$focusedRow=b.first().addClass(this.options.focusOptions.focusedClass),
d||this.scrollToRow(this._$focusedRow))};a.prototype._handleOpen=function(){this._$focusedRow.find(".task-link-button").trigger("click")};a.prototype._handleEdit=function(){this.getTaskListRowViewForTask(this.getTaskFromFocusedRow()).setCollapsed(!1);this._$focusedRow.find(".task-edit").trigger("click")};a.prototype._handleTransitionToNextState=function(){var a=this.getTaskFromFocusedRow();a&&a.transitionToNextState()};a.prototype._handleDelete=function(){this._$focusedRow.find(".task-delete").trigger("click")};
a.prototype.getTaskFromFocusedRow=function(){var a=this._$focusedRow.find(".task").data("task-id");return a&&this.collection.get(a)};a.prototype._onTaskDestroy=function(a){var e=d.find(this._taskRowViews,h.dotEq("model",a));if(e){var b=this._$focusedRow.is(this.options.taskContainerSelector+":last")?"prevAll":"nextAll";this._focusRow(b,!0);e.remove();this._taskRowViews=d.without(this._taskRowViews,e);a.getLastState()===g.RESOLVED&&(a=d.compose(h.eq(g.RESOLVED),h.invoke("model.getState")),this._taskRowViews.some(a)||
(this._resolvedHeaderOutput=!1,this.$table.find(".section-heading").remove()));0===this._taskRowViews.length&&this._addNoRowsMessage()}};return a});