define("bitbucket/internal/feature/tasks/taskable-comment","jquery lodash bitbucket/util/events bitbucket/util/state bitbucket/internal/feature/comments/comment-async-web-panel bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/model/task-collection bitbucket/internal/feature/tasks/task-list/comment-task-list-view exports".split(" "),function(f,m,h,g,r,n,p,t,k){var e=p.getCollection(),l={};h.on("bitbucket.internal.feature.tasks.createTask",function(d){var a=f(d),b=a.data("id");
d="";var c=window.getSelection();if(c){var q=a.find(".message").get(0);f.contains(q,c.anchorNode)&&(f.contains(q,c.focusNode)||a.find(".actions").is(c.focusNode))&&(d=n.sanitiseText(c.toString()),c.removeAllRanges())}b=l[b];(a=b.createTask(d))?e.add(a):d&&(a=b.getCurrentTask(),b=(b=b.getCurrentTaskText())?b.trim()+" ":"",a.setText(b+d))});h.on("bitbucket.internal.feature.comments.commentDeleted",function(d){var a=e.find(function(b){return b.getAnchor().id===d.id});a&&e.remove(a)});h.on("bitbucket.internal.comment.commentContainerDestroyed",
function(d){var a=d.find(".task").map(function(b,c){return+c.dataset.commentId});e.filter(function(b){return m.contains(a,b.getAnchor().id)&&b.isNew()}).forEach(function(b){return b.destroy()})});k.newTaskableCommentView=function(d){var a=d.comment,b=new p;m.each(a.tasks,function(c){var a=e.get(c.id);a||(a=new n(c),a.setPullRequestId(g.getPullRequest().id),a.setRepositoryId(g.getRepository().id),e.add(a));b.add(a)});return r.getWebPanelEl(function(c){var d=f(bitbucket.internal.feature.tasks.taskableComment.taskListPlaceholder());
c.replaceWith(d);c=f(d);c=new t({collection:b,el:c,comment:a,pullRequestId:g.getPullRequest().id,repositoryId:g.getRepository().id});c.render();l[a.id]=c})};k.isPullRequest=function(d){return!!d.pullRequest};k._commentTaskListViews=l});