define("bitbucket/internal/feature/commits/commits-table","aui aui/flag jquery lodash bitbucket/internal/util/events bitbucket/internal/widget/paged-table".split(" "),function(b,n,g,p,l,d){function c(e,a){this.getCommitsUrlBuilder=e;var f={target:"#commits-table",ajaxDataType:"html",tableMessageClass:"commits-table-message",allFetchedMessageHtml:'\x3cp class\x3d"no-more-results"\x3e'+b.escapeHtml(b.I18n.getText("bitbucket.web.commit.allcommitsfetched"))+"\x3c/p\x3e",noneFoundMessageHtml:'\x3ch3 class\x3d"no-results entity-empty"\x3e'+
b.escapeHtml(b.I18n.getText("bitbucket.web.commit.nocommitsfetched"))+"\x3c/h3\x3e",paginationContext:"commits-table"};a=g.extend({},f,a);d.call(this,a);this.$spinner.addClass("commits-table-spinner");this._destroyables=[]}g.extend(c.prototype,d.prototype);c.prototype.buildUrl=function(e,a){return this.getCommitsUrlBuilder().withParams({start:e,limit:a,contents:""}).build()};c.prototype.onDataLoaded=function(e,a,b){"string"===typeof b&&(b=this.createDataFromJQuery(e,a,g(b)));return d.prototype.onDataLoaded.call(this,
e,a,b)};c.prototype.attachNewContent=function(b,a){d.prototype.attachNewContent.call(this,b,a);l.trigger("bitbucket.internal.widget.commitsTable.contentAdded",this,b)};c.prototype.handleNewRows=function(b,a){this.$table.show().children("tbody")["html"!==a?a:"append"](b.values)};c.prototype.focusInitialRow=function(){this.$table.find("tbody tr.commit-row:first").addClass("focused-commit")};c.prototype.bindKeyboardShortcuts=function(){var c=this,a=this.$table.selector,f=!1,h={focusedClass:"focused-commit",
wrapAround:!1,escToCancel:!1},m=a+" .commit-row."+h.focusedClass,k=m+", "+a+".show-merges .commit-row, "+a+":not(.show-merges) .commit-row:not(.merge)";this._onDisableOpenItemHandler=function(){f=!0};this._onEnableOpenItemHandler=function(){f=!1};this.bindMoveToNextHandler=function(a){(this.moveToNextItem?this:b.whenIType(a)).moveToNextItem(k,h).execute(function(){g(k).last().hasClass(h.focusedClass)&&window.scrollTo(0,document.documentElement.scrollHeight)})};this.bindMoveToPreviousHandler=function(a){(this.moveToPrevItem?
this:b.whenIType(a)).moveToPrevItem(k,h)};this.bindOpenItemHandler=function(a){(this.execute?this:b.whenIType(a)).execute(function(){if(!f){var a=jQuery(m);a.length&&(window.location.href=a.find("td.commit a").attr("href"))}})};this.bindToggleMergesHandler=function(a){var d;(this.execute?this:b.whenIType(a)).execute(function(){c.$table.toggleClass("show-merges");var a=c.$table.hasClass("show-merges")?b.I18n.getText("bitbucket.web.commit.filter-all"):b.I18n.getText("bitbucket.web.commit.filter-hide-merge");
d&&d.close();d=n({type:"info",title:a,close:"auto"})})};this._destroyables.push(l.chain().on("bitbucket.internal.keyboard.shortcuts.requestMoveToNextHandler",this.bindMoveToNextHandler).on("bitbucket.internal.keyboard.shortcuts.requestMoveToPreviousHandler",this.bindMoveToPreviousHandler).on("bitbucket.internal.keyboard.shortcuts.requestOpenItemHandler",this.bindOpenItemHandler).on("bitbucket.internal.keyboard.shortcuts.requestToggleMergesHandler",this.bindToggleMergesHandler).on("bitbucket.internal.keyboard.shortcuts.disableOpenItemHandler",
this._onDisableOpenItemHandler).on("bitbucket.internal.keyboard.shortcuts.enableOpenItemHandler",this._onEnableOpenItemHandler));this._destroyables.push(d.prototype.initShortcuts.call(this))};c.prototype.destroy=function(){d.prototype.destroy.call(this);p.invoke(this._destroyables,"destroy")};return c});