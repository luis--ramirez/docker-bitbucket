define("bitbucket/internal/feature/file-content/side-by-side-diff-view/synchronized-scroll","jquery lodash bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/math bitbucket/internal/util/synchronized-scroll exports".split(" "),function(v,e,w,y,l,x,z,A){function B(a){function c(){d&&(d.end=f,d.from.end=b,d.to.end=g,m.push(d))}var d=null,f=0,b=0,g=0,m=[];e.forEach(a,function(a){d&&a.segment===d.segment||
(c(),d={segment:a.segment,lineInfos:[],start:f,end:-1,from:{start:b,end:-1,lineInfos:[]},to:{start:g,end:-1,lineInfos:[]}});f++;d.lineInfos.push(a);a.segment.type!==w.ADDED&&(b++,d.from.lineInfos.push(a));a.segment.type!==w.REMOVED&&(g++,d.to.lineInfos.push(a))});c();return m}function q(a,c){this._id=a;this._editor=c;this._programmatic=!1}function u(a,c,d,e,b,g){this._editor=a;this._startIndex=c;this._endIndex=d;this._numLines=d-c;this._id=e;this._seg=b;this._cachedInfo=null;this._lineInfos=g}function C(a,
c){var d,f,b;return{_linkedRegions:a,_seg:a[0]._seg,_id:"combined_"+e.pluck(a,"_id").join("_"),_scrollable:b,_setCombinedScrollable:function(a){this._scrollable=b=a},getHeight:function(){null==d&&(d=a.map(function(a){return a.getHeight()}).reduce(l.binary(Math.max),0));return d},_getOffset:function(){null==f&&(f=c());return f},getOffsetTop:function(){return this._getOffset()-b._getScrollTop()},_invalidateCache:function(){f=d=null}}}function D(a,c){function d(a){g=x.clamp(0,c.getScrollHeight()-c.getClientHeight())(a)}
this._id=a;var e=l.constant(0);c=v.extend({initialScrollTop:0,getClientHeight:e,getScrollHeight:e},c);var b=!1,g=c.initialScrollTop,m,p=v.Callbacks();this._getScrollTop=function(){return x.clamp(0,c.getScrollHeight()-c.getClientHeight())(g)};this.scrollToNative=function(a,b){null!=b&&(d(b),m&&m(),p.fire(a,b,"native"))};this._setScrollHandler=function(a){m=a};this.getScrollInfo=function(){return{top:this._getScrollTop(),left:0,height:c.getScrollHeight(),width:0,clientHeight:c.getClientHeight(),clientWidth:0}};
this.scrollTo=function(a,c){null!=c&&(b=!0,d(c),p.fire(a,c,"sync"))};this.on=function(a,b){"scroll"===a&&p.add(b)};this.getAndUnsetProgrammaticScrollMarker=function(){var a=b;b=!1;return a}}function E(a,c,d,f,b){function g(a,b,c,d,e){return new u(a,b.start,b.end,e+"_"+b.start+"_"+b.end,c,d)}function m(a,b){var c=g(d,a.from,a.segment,a.from.lineInfos,"from"),e=g(f,b.to,b.segment,b.to.lineInfos,"to");h.push(c);k.push(e)}function p(a){return e.invoke.bind(e,a,"_invalidateCache")}var h=[],k=[];c=B(c);
var n=e.reduce(c,function(a,b){if(a&&b.segment.type===w.ADDED)return m(a,b),null;a&&m(a,a);if(b.segment.type===w.REMOVED)return b;m(b,b);return null},null);n&&m(n,n);var n=e.zip(h,k),q=e.compose(l.partialRight(e.reduce,x.add,0),l.partialRight(e.invoke,"getHeight"),e.take);b=b.includeCombinedRegions?e.reduce(n,function(a,b,c){c=e.partial(q,a,c);a.push(C(b,c));return a},[]):[];var r={};b.length?e.chain(h).zip(k,b).forEach(l.spread(function(a,b,c){r[a._id]=[b,c];r[b._id]=[a,c];r[c._id]=[a,b]})).value():
e.forEach(n,l.spread(function(a,b){r[a._id]=[b];r[b._id]=[a]}));d.on("change",p(h.concat(b)));f.on("change",p(k.concat(b)));var t=p(h.concat(k,b));v(window).on("resize",t);a.on("widgetAdded",t);a.on("widgetChanged",t);a.on("widgetCleared",t);a.on("internal.acceptedModification",t);var F=y.chain().on("bitbucket.internal.feature.commit.difftree.collapseAnimationFinished",t);return{combinedSegments:c,fromRegions:h,toRegions:k,combinedRegions:b,linkedFromAndToRegions:n,linkedRegionsByRegionId:r,destroy:function(){F.destroy();
v(window).off("resize",t)}}}function G(a,c,d,f,b,g){function m(a,b){var c=r(a)||[];return e.find(c,l.dotEq("_editor",b._editor))}function p(a){a.scrollable.scrollTo(a.scrollLeft,a.scrollTop)}function h(b){a.operation(e.forEach.bind(e,b,p));a.trigger("sync-scroll")}function k(a,b,c){var d;c.includeHorizontal?d=h:(d=l.partialRight(e.map,l.unary(l.partialRight(e.omit,"scrollLeft"))),d=e.compose(h,d));return z.getScrollHandler({self:a,others:b,getRegions:q,getLinkedRegion:m,executeCommands:d,focusHeightFraction:c.focusHeightFraction})}
var n={};n[c._id]=b.fromRegions;n[d._id]=b.toRegions;f&&(n[f._id]=b.combinedRegions);var q=e.compose(l.lookup(n),l.dot("_id")),r=e.compose(l.lookup(b.linkedRegionsByRegionId),l.dot("_id"));b={includeHorizontal:!0,focusHeightFraction:g.focusHeightFraction};b={fromHandler:k(c,e.compact([d,f]),b),toHandler:k(d,e.compact([c,f]),b)};f&&(b.combinedHandler=k(f,[c,d],{includeHorizontal:!1,focusHeightFraction:g.focusHeightFraction}));return b}q.prototype.getScrollInfo=function(){return this._editor.getScrollInfo()};
q.prototype.scrollTo=function(a,c){this._programmatic=this._programmatic||null!=a||null!=c;this._editor.scrollTo(a,c)};q.prototype.getAndUnsetProgrammaticScrollMarker=function(){var a=this._programmatic;this._programmatic=!1;return a};u.prototype.getHeight=function(){return this._getCachedInfo().height};u.prototype.getOffsetTop=function(){return this._getCachedInfo().offsetTop-this._editor.getScrollInfo().top};u.prototype._getCachedInfo=function(){if(!this._cachedInfo){this._cachedInfo={height:0,
offsetTop:this._editor.heightAtLine(this._startIndex,"local")};if(!this._numLines)return this._cachedInfo;var a=this._editor.heightAtLine(this._endIndex,"local");this._cachedInfo.height=a-this._cachedInfo.offsetTop}return this._cachedInfo};u.prototype._invalidateCache=function(){this._cachedInfo=null};A.setupScrolling=function(a,c,d,f,b){b=b||{};var g=E(a,c,d,f,{includeCombinedRegions:b.includeCombinedScrollable});c=new q("from",d);var m=new q("to",f),l=0,h;b.includeCombinedScrollable&&(h=new D("combined",
{getScrollHeight:function(){return e.chain(g.combinedRegions).invoke("getHeight").reduce(x.add,0).value()},getClientHeight:function(){return l}}));var k=G(a,c,m,h,g,b);d.on("scroll",k.fromHandler.handle);f.on("scroll",k.toHandler.handle);b={combinedSegments:g.combinedSegments,combinedRegions:g.combinedRegions,combinedScrollable:h,linkedFromAndToRegions:g.linkedFromAndToRegions,destroy:function(){d.off("scroll",k.fromHandler.handle);f.off("scroll",k.toHandler.handle);g.destroy()}};h&&(h._setScrollHandler(k.combinedHandler.handle),
h.setClientHeight=function(a){l=h.clientHeight=a;k.combinedHandler.reset()},e.invoke(g.combinedRegions,"_setCombinedScrollable",h),b.combinedScrollable=h);c=e.invoke.bind(e,k,"reset");a.on("widgetCleared",c);a.on("widgetChanged",c);a.on("widgetAdded",c);return b}});