define("bitbucket/internal/feature/file-content/binary-diff-view",["jquery","bitbucket/internal/bbui/image-differ/image-differ","bitbucket/internal/feature/file-content/binary-view","bitbucket/internal/model/file-change","bitbucket/internal/util/events"],function(f,k,l,m,n){function c(a,b){this._init(a,b)}function h(a,b){if(a&&b)return l.getRenderedBinary(a,b.getId())}c.prototype.isDiffingImages=function(){return this._isDiffingImages};c.prototype._init=function(a,b){var d=(new m(b.fileChange)).getCommitRange(),
e=d.getUntilRevision(),d=d.getSinceRevision();this._$container=f(bitbucket.internal.feature.fileContent.binaryView.container()).appendTo(b.$container);var c=h(a.source,d),g=h(a.destination,e);this._renderBinaryDiff(c,g).done(function(){b.$container.addClass("fully-loaded")});e={containerEl:this._$container.get(0),sourcePath:a.source,sourceType:c&&c.type,sinceRevision:d&&d.toJSON(),destinationPath:a.destination,destinationType:g&&g.type,untilRevision:e&&e.toJSON()};n.trigger("bitbucket.internal.feature.fileContent.binaryDiffShown",
null,e)};c.prototype._renderBinaryDiff=function(a,b){var c=this;a&&f(bitbucket.internal.feature.fileContent.binaryView.old({})).append(a.$elem).appendTo(this._$container);b&&f(bitbucket.internal.feature.fileContent.binaryView.new({})).append(b.$elem).appendTo(this._$container);return(this._isDiffingImages=a&&b&&a.type===b.type&&"image"===a.type)?k.init(this._$container).done(function(a){c.imageDiff=a}):f.Deferred().resolve()};c.prototype.destroy=function(){this.imageDiff&&(this.imageDiff.destroy(),
this.imageDiff=null);this._$container&&(this._$container.remove(),this._$container=null)};return c});