define("bitbucket/internal/feature/file-content/unified-diff-view","jquery lodash bitbucket/internal/feature/file-content/diff-line-info bitbucket/internal/feature/file-content/diff-view bitbucket/internal/feature/file-content/diff-view-context bitbucket/internal/feature/file-content/diff-view-file-types bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/feature/file-content/line-handle bitbucket/internal/feature/file-content/text-view/attach-simple-scroll-behavior bitbucket/internal/model/file-change-types bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/object bitbucket/internal/feature/file-content/stash-codemirror/search".split(" "),
function(l,g,n,f,p,q,k,w,x,r,y,t,z){function A(a){var b=a.destinationLine,c=a.sourceLine;a.segments[0].lines=g.map(a.segments[0].lines,function(a){a.destination=b++;a.source=c++;return a});return a}function B(a,b){if(b.linesAdded){var c=b.diff,e=p.getSeparatedHunkHtml(c.hunks,a._options.fileChange.type),d,h=[],m,f;b.eachLine(function(a){var b=a.handles.FROM||a.handles.TO;a.hunk!==f&&(f=a.hunk,h.push(b));m=b}).done(function(){switch(b.type){case "INSERT":var f=a._editor.getLineNumber(h[0]._handle),
k=0===f,l=a._editor.lastLine()-b.linesAdded,f=f>l;1<c.hunks.length?(h.shift(),e.shift(),e.pop(),m=void 0):(k||(h.shift(),e.shift()),f?d=e.pop():(e.pop(),m=void 0));break;case "INITIAL":h.length===e.length-1&&(d=e.pop());break;default:throw Error("Unrecognized change type: "+b.type);}a.operation(function(){g.each(g.zip(e,h),t.spread(g.partial(u,a,!0)));d&&!a._isEntireFile()&&u(a,!1,d,m)})})}}function u(a,b,c,e){if(c){c=l(c);var d=a.addLineWidget(e,c[0],{coverGutter:!0,noHScroll:!0,above:b});b&&a.addLineClass(e,
"wrap","first-line-of-hunk");c.data("widget",d)}}function C(a){a&&a.clear()}function v(a,b){return{lineNumber:a===k.ADDED?b.destination:b.source,lineType:a}}function d(a,b){f.apply(this,arguments)}z.inherits(d,f);d.defaults=f.defaults;d.prototype.init=function(){if(this._$container){var a=this;this._$container.addClass("unified-diff");this.on("internal-change",g.partial(B,this));this._options.isExcerpt||p.attachExpandContext(this._$container,this._options.fileChange,this._expandContextLines);this._$container.append(bitbucket.internal.feature.fileContent.unifiedDiffView.layout());
var b=this._options.commentContext&&this._options.commentContext.getGutterId();b&&this.registerGutter(b,{weight:100});this.registerGutter("line-number-from",{weight:200});this.registerGutter("line-number-to",{weight:300});this.registerGutter("gutter-border",{weight:1500});this._editor=this._createEditor({},this._$container.children(".diff-editor"));this._isEntireFile()&&(b=t.dot("hunks.0.segments.0.lines.0.line")(this._data.diff),this._syntaxHighlighting(this._options.fileChange.path.name,b,this._editor));
this._addDestroyable(function(){a._editor=null});this._scrollingReady.always(function(){a._editor&&(a._editor.setOption("scrollLineIntoViewFunc",function(b){b=a._editor.getLineHandle(b.from.line)._stashHandle;a.scrollHandleIntoFocus(b)}),a._modifyDiff("INITIAL",a._data.diff,n.convertToLineInfos(a._data.diff,a._options)))});f.prototype.init.call(this)}};d.prototype._acceptModification=function(a,b,c,e){e=e||0;var d=this._editor;b=f._combineTexts(c);switch(a){case "INITIAL":d.setValue(b);break;case "INSERT":d._insert(b,
e,!0);break;default:throw Error("Unrecognized change type: "+a);}g.each(c,function(a,b){var c=new w(void 0,a.lineType,a.lineNumber,d.getLineHandle(b+e));a.lineType!==k.ADDED&&a._setHandle(q.FROM,c);a.lineType!==k.REMOVED&&a._setHandle(q.TO,c)})};d.prototype._getFocusSegment=function(a){var b=this._editor,c=b.getScrollInfo();a=Math.ceil(c.clientHeight*this._options.focusPoint)-Math.floor(a);if(0>a)return null;c=Math.min(b.lastLine(),b.lineAtHeight(c.top+a+1,"local"));b=b.getLineHandle(c);return(b=
this._internalLines[b._stashHandle.lineType][b._stashHandle.lineNumber])&&b.segment};d.prototype._setFocusSegment=function(a){var b=a[0];this.scrollHandleIntoFocus(this.getLineHandle(v(b.type,b.lines[0])));a=g.chain(a).pluck("lines").flatten().map(v.bind(null,b.type)).map(this.getLineHandle).value();this._markLinesFocused([{editor:this._editor,handles:a}])};d.prototype._getFocusLine=function(){var a=this._editor,b=a.getScrollInfo(),c=this._$fileToolbar&&this._$fileToolbar.outerHeight(),c=this._$container[0].getBoundingClientRect().top-
c,d=Math.ceil(b.clientHeight*this._options.focusPoint)-(this._editorInnerOffset()-Math.abs(c)),c=0>=c?d:0,b=Math.min(a.lastLine(),a.lineAtHeight(b.top+c+1,"local"));return a.getLineHandle(b)._stashHandle};d.prototype._findNextAnchor=function(a,b,c){return this._findNextAnchorInEditor(this._editor,b,a,c)};d.prototype._attachScrollBehavior=function(){return this._$container?x(this,this._editor,this._$container.children(".diff-editor")):l.Deferred().reject()};d.prototype._editorForHandle=function(){return this._editor};
d.prototype._isEntireFile=function(){return(this._options.fileChange.type===r.ADD||this._options.fileChange.type===r.DELETE)&&!this._options.isExcerpt};d.prototype._expandContextLines=function(a,b,c){if(this._editor){var d=this.getLineHandle(b);a=this._editor.getLineNumber(d._handle);var f=this._editor.lastLine()===a?a+1:a;this.removeLineClass(d,"wrap","first-line-of-hunk");c.forEach(function(a){a.sourceSpan=a.destinationSpan=a.segments[0].lines.length;A(a)});c.length&&c[0].segments.length&&c[0].segments[0].lines.length&&
(d={hunks:c},this._modifyDiff("INSERT",d,n.convertToLineInfos(d,this._options),f));C(b.data("widget"));y.trigger("bitbucket.internal.feature.fileContent.diffViewExpanded",null,{$context:b,hunk:c,at:a})}};return d});