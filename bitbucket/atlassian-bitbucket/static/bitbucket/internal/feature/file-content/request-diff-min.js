define("bitbucket/internal/feature/file-content/request-diff","jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/file-content/diff-view-options bitbucket/internal/model/path bitbucket/internal/util/ajax bitbucket/internal/util/deprecation".split(" "),function(g,h,p,q,l,m,n){function r(c,a){if(g.isArray(a.diffs)&&a.diffs.length){var b=h.find(a.diffs,function(a){return a.destination?a.destination.toString===(new l(c.path)).toString():c.srcPath?a.source.toString===(new l(c.srcPath)).toString():
!1})||a.diffs[0];a=h.assign({diff:b},a,b);Object.keys(b).forEach(function(b){n.prop(a,b,b,"diff."+b,"4.5","5.0")});delete a.diffs}return a}function t(c){var a=p.rest().project(c.repository.project.key).repo(c.repository.slug),b=c.commitRange.pullRequest;return(b?a.pullRequest(b.id):a.commit(c.commitRange)).diff(c)}var f={};return function(c,a){var b=c.toJSON?c.toJSON():c;if(b.diff){var d=g.extend({lineComments:a.lineComments||[],fileComments:a.fileComments||[]},b.diff),h=g.extend({diff:d,fromHash:b.diff.properties&&
b.diff.properties.fromHash,toHash:b.diff.properties&&b.diff.properties.toHash},d);Object.keys(d).forEach(function(a){n.prop(h,a,a,"diff."+a,"4.5","5.0")});return g.Deferred().resolve(h)}a=a||{};var d=a.hasOwnProperty("ignoreWhitespace")?a.ignoreWhitespace:q.get("ignoreWhitespace"),k=isNaN(Number(a.contextLines))?-1:Math.floor(a.contextLines),e=(a.diffUrlBuilder||t)(b).withParams({avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:a.avatarSize||"medium"}),markup:!0,whitespace:d?"ignore-all":
"",contextLines:k,withComments:a.withComments,autoSrcPath:a.autoSrcPath}).build();if(f.hasOwnProperty(e)&&"rejected"!==f[e].state())return f[e];d=m.rest({url:e,statusCode:a.statusCode||m.ignore404WithinRepository()});k=d.then(function(a){if(a.errors&&a.errors.length)return g.Deferred().rejectWith(this,[this,null,null,a]);a=r(b,a);setTimeout(function(){delete f[e]});return a});f[e]=k.promise(d);return f[e]}});