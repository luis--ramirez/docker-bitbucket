define("bitbucket/internal/feature/file-content/file-blame","jquery lodash bitbucket/util/events bitbucket/util/navbuilder bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/feature/file-content/file-blame/blame-diff bitbucket/internal/feature/file-content/file-blame/blame-gutter bitbucket/internal/feature/file-content/file-blame/blame-source bitbucket/internal/model/file-change-types bitbucket/internal/model/file-content-modes bitbucket/internal/util/analytics bitbucket/internal/util/promise bitbucket/internal/util/shortcuts bitbucket/internal/widget/button-trigger exports".split(" "),
function(u,d,h,v,f,w,x,y,k,r,z,A,B,C,n){function D(e,b){var a;if(e.type===k.ADD||e.type===k.DELETE)a=d.first(b.diff.hunks),a={firstAddedLine:a.destinationLine,lastAddedLine:a.destinationSpan,firstRemovedLine:a.sourceLine,lastRemovedLine:a.sourceSpan};else{var c=d.chain(b.diff.hunks).map("segments").flatten().reject(d.matchesProperty("type",f.CONTEXT)).groupBy("type").mapValues(function(a){return d.chain(a).map("lines").flatten().value()}).value();a=c[f.ADDED]||[];c=c[f.REMOVED]||[];a={firstAddedLine:a.length&&
d.first(a).destination,lastAddedLine:a.length&&d.last(a).destination,firstRemovedLine:c.length&&d.first(c).source,lastRemovedLine:c.length&&d.last(c).source}}a.since=b.fromHash;a.until=b.toHash;return a}function E(d,b){return{firstLine:b.firstLine,lastLine:b.firstLine+b.linesAdded-1,haveWholeFile:1===b.firstLine&&b.isLastPage}}var F={"/browse":"source-view","/diff":"diff-to-previous","/commits/":"commit","/compare":"compare-branch","/pull-requests?create":"create-pullrequest","/pull-requests":"pullrequest"};
n.init=function(){function e(b,a){function c(a){g.initBlameOptions(p(e,a))}var e=a.fileChange,f=a.$toolbar.find(".file-blame"),g,p,l,k=d.once(function(a){var b=v.currentRepo().buildAbsolute(),c=d.find(F,function(a,c){return d.startsWith(location.href,b+c)?a:!1});z.add("blame.shown",{type:a,source:c})});if(f.length){if(a.contentMode===r.SOURCE)g=new y(e),l="bitbucket.internal.feature.fileContent.sourceViewContentLoaded",p=E;else if(a.contentMode===r.DIFF)g=new w(e),l="bitbucket.internal.feature.fileContent.diffViewDataLoaded",
p=D;else return;h.on(l,c);var m=new x(b,g),t=u('\x3cdiv class\x3d"blame-spinner"\x3e\x3c/div\x3e'),q=new C(f,{stopEvent:!1,triggerHandler:function(){this.setTriggerActive(!this.isTriggerActive());A.spinner(t.insertBefore(f),m.setEnabled(this.isTriggerActive()));k(a.contentMode)}}),n=B.bind("showBlame",q.triggerClicked.bind(q));b.on("destroy",function(){n();t.remove();h.off(l,c);d.isFunction(m.destroy)&&m.destroy();g=q=m=null})}}h.on("bitbucket.internal.feature.fileContent.textViewInitializing",e);
return{destroy:function(){h.off("bitbucket.internal.feature.fileContent.textViewInitializing",e)}}}});