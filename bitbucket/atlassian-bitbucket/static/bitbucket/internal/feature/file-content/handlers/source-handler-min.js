define("bitbucket/internal/feature/file-content/source-handler","jquery lodash bitbucket/feature/files/file-handlers bitbucket/internal/feature/file-content/binary-source-view bitbucket/internal/feature/file-content/binary-view bitbucket/internal/feature/file-content/content-message bitbucket/internal/feature/file-content/request-source bitbucket/internal/feature/file-content/source-view bitbucket/internal/model/file-content-modes bitbucket/internal/util/deep-linking bitbucket/internal/util/error bitbucket/internal/util/property exports".split(" "),
function(b,e,g,k,d,m,q,r,t,u,v,w,a){function f(c,h,n){if(!h)throw Error("Every handler we expose from core needs to have a handlerID.");return function(d){if(d.contentMode!==t.SOURCE)return b.Deferred().reject();var a={includeBlame:!1};e.isFunction(n)&&e.extend(a,{start:n(d.anchor)});var f=d.$container;return q(d.fileChange,a).then(function(b){return c(b,d)}).then(function(c){c.handlerID||(c.handlerID=h);return c},function(c,h,d,a){return a&&a.errors&&v.isErrorEntityWithinRepository(a.errors[0])?
(m.renderErrors(f,a),b.Deferred().resolve({handlerID:g.builtInHandlers.ERROR})):b.Deferred().reject()})}}function p(c,h){if(!c.lines||0===c.lines.length)return b.Deferred().reject();var a=new r(c,h);e.defer(a.init.bind(a));return b.Deferred().resolve(a)}var l=5E3;w.getFromProvider("page.max.source.lines").done(function(c){l=c});a.handleBinary=f(function(c,a){return c.binary||d.treatTextAsBinary(a.fileChange.path.extension)?b.Deferred().resolve(new k(a)):b.Deferred().reject()},g.builtInHandlers.SOURCE_BINARY);
a.handleImage=f(function(c,a){return!c.binary&&!d.treatTextAsBinary(a.fileChange.path.extension)||"image"!==d.getRenderedBinary(a.fileChange.path,a.fileChange.commitRange.untilRevision).type?b.Deferred().reject():b.Deferred().resolve(new k(a))},g.builtInHandlers.SOURCE_IMAGE);a.handleEmptyFile=f(function(c,a){if(!c.lines||0!==c.lines.length)return b.Deferred().reject();m.renderEmptyFile(a.$container,c,a.fileChange);return b.Deferred().resolve({})},g.builtInHandlers.SOURCE_EMPTY);a.handleTextDeepLink=
f(p,g.builtInHandlers.SOURCE_TEXT,function(a){if(e.isString(a)&&(a=u.hashToLineNumbers(a),a.length))return Math.floor((e.first(a)-1)/l)*l});a.handleText=f(p,g.builtInHandlers.SOURCE_TEXT)});
(function(){function b(b,k){e.register({weight:b,extraClasses:"source-file-content",handle:function(b){return require("bitbucket/internal/feature/file-content/source-handler")[k](b)}})}var e=require("bitbucket/feature/files/file-handlers");b(1E4,"handleImage");b(10300,"handleBinary");b(10700,"handleEmptyFile");b(10999,"handleTextDeepLink");b(11E3,"handleText")})();