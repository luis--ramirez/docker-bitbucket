define("bitbucket/internal/feature/file-content/diff-line-info",["lodash","bitbucket/internal/feature/file-content/diff-view-segment-types","exports"],function(a,h,n){function m(d,g,b,e,k,c,f){this.lineType=d;this.lineNumber=g;this.line=b;this.segment=e;this.hunk=k;this.diff=c;this.handles={FROM:null,TO:null,all:[]};this.attributes=f}var p={ADDED:"destination",REMOVED:"source",CONTEXT:"source"};m.prototype._setHandle=function(d,g){this.handles[d]=g;this.handles.all.push(g);this.handles.all=a.uniq(this.handles.all)};
n.convertToLineInfos=function(d,g){return a.chain(d.hunks).map(function(b){return a.map(b.segments,function(e,k){var c;var f=b.segments;c=g.relevantContextLines;var d=f[k-1],f=f[k+1];if(e.type!==h.CONTEXT)c=null;else{var a=0,l=e.lines.length;!d||d.type!==h.ADDED&&d.type!==h.REMOVED||(a=c);!f||f.type!==h.ADDED&&f.type!==h.REMOVED||(l-=c);c=l>a?{start:a-1,end:l}:null}return{hunk:b,segment:e,expandedRange:c}})}).flatten().map(function(b){var e=b.segment;return a.map(e.lines,function(a,c){return new m(e.type,
a[p[e.type]],a,e,b.hunk,d,{expanded:b.expandedRange&&c<b.expandedRange.end&&c>b.expandedRange.start})})}).flatten().value()}});