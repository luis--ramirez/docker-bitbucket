define("bitbucket/internal/feature/file-content/text-view/text-view-api","jquery lodash bitbucket/internal/util/array bitbucket/internal/util/function bitbucket/internal/util/mixin bitbucket/internal/util/object exports".split(" "),function(n,e,p,f,q,r,h){function t(a){a.classList.add("bitbucket-gutter-marker");return a}var l={addLineClass:function(a,b,d){this._editorForHandle(a).addLineClass(a._handle,b,d);return a},addLineWidget:function(a,b,d){var c=this._editorForHandle(a).addLineWidget(a._handle,
b,d),g=this;g.trigger("widgetAdded");return{clear:function(){c.off("redraw");c.clear();g.trigger("widgetCleared")},changed:function(){c.changed();g.trigger("widgetChanged")},onRedraw:function(a){c.on("redraw",a)},getHeight:function(){return c.height}}},getLine:function(a){return a._handle.text},getLineHandle:function(a){a&&null==a.lineNumber&&(a=n(a),a.is(".line-locator")||(a=a.closest(".line").find(".line-locator")),a={fileType:a.attr("data-file-type"),lineType:a.attr("data-line-type"),lineNumber:a.attr("data-line-number")});
var b=a&&this._internalLines[a.lineType||"CONTEXT"][a.lineNumber]&&this._internalLines[a.lineType||"CONTEXT"][a.lineNumber].handles;return b&&(b[a.fileType]||b.all[0])},operation:function(a){if(this._editors){a=this._editors.reduce(function(a,c){return c.operation.bind(c,a)},f.arity(a.bind(null),0));try{return this._inOp||(this._opCallbacks=[],this._inOp=0),this._inOp++,a()}finally{if(this._inOp--,!this._inOp){try{f.applyAll(this._opCallbacks)}catch(b){setTimeout(function(){throw b;},0)}this._opCallbacks=
null}}}},registerGutter:function(a,b){b=b||{};if(this._editors){this._gutters.push({name:a,weight:b.weight||0,fileType:b.fileType});this._gutters=r.uniqueFromArray(this._gutters,["name","fileType"]).sort(function(a,b){return a.weight-b.weight||a.name.localeCompare(b.name)});var d=this;this._editors.forEach(function(a){var b=d._getGutters(a._gutterFilter);e.isEqual(a.getOption("gutters"),b)||a.setOption("gutters",b)})}},removeLineClass:function(a,b,d){this._editorForHandle(a).removeLineClass(a._handle,
b,d);return a},setGutterMarker:function(a,b,d){this._editorForHandle(a).setGutterMarker(a._handle,b,t(d));return a},addContainerClass:function(a){this._$container.addClass(a);this.refresh()},removeContainerClass:function(a){this._$container.removeClass(a);this.refresh()}},u=Object.keys(l),m={destroy:0,load:1,change:1};h.setupAPI=function(a){var b={};a._api={};var d=[a].concat(u);e.bindAll.apply(e,d);e.extend(a._api,{on:function(c,d){if(e.has(m,c)){b[c]||(b[c]=[]);var k=f.arity(d.bind(a._api),m[c]);
b[c].push({f:d,wrappedF:k});a.on(c,k)}},off:function(c,d){if(b[c]){var e=p.findIndex(f.dotEq("f",d))(b[c]||[]);-1!==e&&(a.off(c,b[c][e].wrappedF),b[c].splice(e,1))}}},e.pick.apply(e,d))};h.mixInto=q(l).into});