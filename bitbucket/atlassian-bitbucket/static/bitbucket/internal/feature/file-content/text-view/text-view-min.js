define("bitbucket/internal/feature/file-content/text-view","jquery lodash bitbucket/internal/bbui/widget/widget bitbucket/internal/feature/file-content/stash-codemirror bitbucket/internal/feature/file-content/text-view/common-modes bitbucket/internal/feature/file-content/text-view/text-view-api bitbucket/internal/feature/file-content/text-view/text-view-scrolling bitbucket/internal/util/determine-language bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/horizontal-keyboard-scrolling bitbucket/internal/util/object bitbucket/internal/util/performance".split(" "),
function(h,f,k,n,p,l,q,r,t,w,m,g,u){function e(a,b){k.call(this,b);var d=this;l.setupAPI(this);this._internalLines={ADDED:{},REMOVED:{},CONTEXT:{}};this._editors=[];this._gutters=[];this._$container=a;this._$fileToolbar=this._$container.siblings(".file-toolbar");this._$container.addClass("text-view");this.registerGutter("CodeMirror-linewidget",{weight:0});this._addDestroyable(function(){d._$container.removeClass("text-view");d._editors.forEach(function(c){c.destroy()});d._editors=null;d._gutters=
null;d._$container=null})}function v(a){var b=a.view;a.eachLine(function(d){d.handles.all.forEach(function(c){b.addLineClass(c,"wrap","line")})})}g.inherits(e,k);l.mixInto(e.prototype);q.mixInto(e.prototype);e.defaults={focusPoint:.2};e.prototype.init=function(){t.trigger("bitbucket.internal.feature.fileContent.textViewInitializing",null,this._api,this._options);m.init()};e.prototype.markText=function(a,b,d,c){var e=this;return a.handles.all.map(function(a){var f=e._editorForHandle(a);a=f.getLineNumber(a._handle);
return f.markText({line:a+b.lineOffset,ch:b.ch},{line:a+d.lineOffset,ch:d.ch},{className:c.className})})};e.prototype.refresh=function(){f.invoke(this._editors,"refresh");this.trigger("resize")};e.prototype._createEditor=function(a,b){a=a||{};var d=new n(b&&b.length?b[0]:this._$container[0],h.extend({},a,{attachScroll:this._options.attachScroll,autoResizing:this._options.autoResizing,gutters:this._getGutters(a.gutterFilter),scrollStyle:this._options.scrollStyle,value:""}));d._gutterFilter=a.gutterFilter;
this._editors.push(d);m.setEditors(this._editors);this._$firstEditor||(this._$firstEditor=h(d.getWrapperElement()));return d};e.prototype._editorForHandle=function(a){throw Error("TextView implementation must define _editorForHandle.");};e.prototype._editorInnerOffset=function(){return this._$firstEditor[0].getBoundingClientRect().top-this._$container[0].getBoundingClientRect().top};e.prototype._getChangeAttributes=function(){return{}};e.prototype._getGutters=function(a){var b=this._gutters;a&&(b=
b.filter(a));b=b.sort(function(a,c){return a.weight-c.weight});return f.chain(b).pluck("name").uniq().value()};e.prototype._modify=function(a,b,d){var c=this,e=[].slice.call(arguments);f.forEach(d,function(a){c._internalLines[a.lineType||"CONTEXT"][a.lineNumber]=a});this.operation(function(){c._acceptModification.apply(c,e);c.trigger("internal.acceptedModification",e);var b=h.extend({type:a,linesAdded:d.length,eachLine:function(a){var b=(c._options.asyncDiffModifications?u.frameBatchedMap(a,{min:500,
initial:200},c.operation.bind(c)):function(b){var c=h.Deferred();c.resolve(b.map(a));return c})(d);c._addDestroyable(b.reject.bind(b));return b.promise()},view:c._api},c._getChangeAttributes.apply(c,e));f.chain(d).pluck("handles").values().flatten().compact().forEach(g.freeze).value();f.chain(d).pluck("handle").compact().forEach(g.freeze).value();f.chain(d).pluck("line").compact().forEach(g.freeze).value();g.deepFreeze(d,!1);g.deepFreeze(b,!1);v(b);"INITIAL"===a&&c.trigger("internal-load",b);c.trigger("internal-change",
b);c.refresh()})};e.prototype._highlight=function(a){this._editors&&this._editors.forEach(function(b){b._highlight(a)})};e.prototype._syntaxHighlighting=function(a,b,d){var c=r.fromFileInfo({firstLine:b,path:a});(c.wrmKey?WRM.require("wr!"+c.wrmKey):c.builtIn&&-1===p.indexOf(c.mode)?WRM.require("wr!com.atlassian.bitbucket.server.bitbucket-highlight:"+c.mode):h.Deferred().resolve()).done(function(){d.setOption("mode",c.mime)})};e.prototype._whenOpDone=function(a){this._opCallbacks?this._opCallbacks.push(a):
a()};return e});