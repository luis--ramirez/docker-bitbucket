define("bitbucket/internal/feature/file-content/ediff/ediff-markers","bacon jquery lodash bitbucket/internal/bbui/ediff/ediff bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/util/bacon bitbucket/internal/util/function".split(" "),function(k,r,d,m,n,t,e){function u(a,c){var h=k.fromBinder(function(b){c.eachLine(b).done(d.partial(b,new k.End));return r.noop});p(h).onValue(function(b){a.markText(b.line,b.from,b.to,b.options)})}function p(a){var c=e.dot("0.line.conflictMarker");
return t.split(a,e.dot("segment")).slidingWindow(2,2).filter(e.partialRight(d.every,e.not(c))).filter(e.spread(function(a,b){return a[0].segment.type===n.REMOVED&&b[0].segment.type===n.ADDED})).flatMap(e.spread(function(a,b){function c(b,a){return k.fromArray(a).map(function(a){return d.extend({},a,{line:b[a.line]})})}var g=v(a[0].segment,b[0].segment);return c(a,g.from).merge(c(b,g.to))}))}function v(a,c){function h(a){a=d.pluck(a.lines,"line").join("\n");return{text:a,tokens:m.tokenizeString(a)}}
var b=h(c),f=h(a);if(!(750>b.tokens.length&&750>f.tokens.length))return{to:[],from:[]};var g=m.diff(f.tokens,b.tokens);return{from:d.map(g.originalRegions,d.partial(q,f.text)),to:d.map(g.revisedRegions,d.partial(q,b.text))}}function q(a,c){var d=a.slice(0,c.start),b=a.slice(c.start,c.end),f=d.lastIndexOf("\n")+1,g=b.lastIndexOf("\n")+1,e=c.start-f,f=c.end-(g?g+c.start:f),d=d.split("\n").length-1,b=b.split("\n").length-1;return{line:d,from:{lineOffset:0,ch:e},to:{lineOffset:b,ch:f},options:{className:"ediff-"+
c.type}}}function w(a){a.off("internal-change",l)}var l;return{init:function(a){l=d.partial(u,a.diffView);a.diffView.on("internal-change",l);return{destroy:d.partial(w,a.diffView)}},_convertLinesToMarkers:p}});