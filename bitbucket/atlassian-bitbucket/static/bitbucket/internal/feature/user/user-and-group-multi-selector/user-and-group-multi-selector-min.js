define("bitbucket/internal/feature/user/user-and-group-multi-selector","aui jquery lodash bitbucket/internal/feature/user/group-multi-selector bitbucket/internal/feature/user/user-multi-selector bitbucket/internal/util/promise bitbucket/internal/widget/searchable-multi-selector".split(" "),function(g,h,c,d,e,u,f){function n(a){return{type:"group",entity:a}}function p(a){return{type:"user",entity:a}}function k(a){a=a||{};return c.map(a.users||[],p).concat(c.map(a.groups||[],n))}function q(a,b){b=h.extend(!0,
{},this.defaults,b);b.initialItems=k(b.initialItems);b.excludedItems=k(b.excludedItems);b.dataSource||(b.dataSource=new l(new r(b.urls.user,b.urlParams.user),new r(b.urls.group,b.urlParams.group)));f.call(this,a,b)}function v(a,b){var w=m[a.type](a.entity),c=m[b.type](b.entity);return w.toLowerCase().localeCompare(c.toLowerCase())}function x(a,b){return{values:a.values.concat(b.values).sort(v),isLastPage:a.isLastPage&&b.isLastPage}}function l(a,b){this._userDataSource=a;this._groupDataSource=b}var r=
f.PagedDataSource,y={user:e.prototype.defaults.selectionTemplate,group:d.prototype.defaults.selectionTemplate},z={user:e.prototype.defaults.resultTemplate,group:d.prototype.defaults.resultTemplate},A={user:e.prototype.defaults.generateId,group:d.prototype.defaults.generateId},m={user:e.prototype.defaults.generateText,group:d.prototype.defaults.generateText};h.extend(!0,q.prototype,f.prototype,{defaults:{initialItems:{user:[],group:[]},excludedItems:{user:[],group:[]},urls:{user:e.prototype.defaults.url,
group:d.prototype.defaults.url},urlParams:{user:e.prototype.defaults.urlParams,group:d.prototype.defaults.urlParams},hasAvatar:!0,selectionTemplate:function(a){return y[a.type](a.entity)},resultTemplate:function(a){return z[a.type](a.entity)},inputTooShortTemplate:function(){return g.escapeHtml(g.I18n.getText("bitbucket.web.user.and.group.multi.selector.help"))},noMatchesTemplate:function(){return g.escapeHtml(g.I18n.getText("bitbucket.web.user.and.group.multi.selector.no.match"))},generateId:function(a){return a.type+
":"+A[a.type](a.entity)},generateText:function(a){return m[a.type](a.entity)}},getSelectedItems:function(){return c.reduce(f.prototype.getSelectedItems.call(this),function(a,b){a[b.type+"s"].push(b.entity);return a},{users:[],groups:[]})},setSelectedItems:function(a){f.prototype.setSelectedItems.call(this,k(a))},clearSelectedItems:function(){return this.setSelectedItems({})}});var t=h.Deferred().resolve({isLastPage:!0,values:[]});l.prototype.clear=function(){this._groupAtEnd=this._userAtEnd=!1;this._userDataSource.clear();
this._groupDataSource.clear()};l.prototype.nextPage=function(a){var b=this._userAtEnd?t:this._userDataSource.nextPage(a),b=b.then(c.bind(function(a){this._userAtEnd=a.isLastPage;a.values=c.map(a.values,p);return a},this)).promise(b);a=this._groupAtEnd?t:this._groupDataSource.nextPage(a);a=a.then(c.bind(function(a){this._groupAtEnd=a.isLastPage;a.values=c.map(a.values,n);return a},this)).promise(a);b=u.reduce(b,a);return b.then(x).promise(b)};return q});