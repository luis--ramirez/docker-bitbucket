define("bitbucket/internal/feature/user/user-groups-table","aui aui/flag jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/group-multi-selector bitbucket/internal/feature/user/group-table bitbucket/internal/util/ajax bitbucket/internal/util/error".split(" "),function(e,l,f,h,d,n,k,m,p){function b(a){k.call(this,f.extend({},{filterable:!1,noneFoundMessageHtml:e.escapeHtml(e.I18n.getText("bitbucket.web.user.groups.noneFound"))},a));this.username=this.$table.attr("data-username");
this.onError=a.onError||p.showNonFieldErrors;this._initBindings=h.once(this._initBindings)}f.extend(b.prototype,k.prototype);b.prototype.buildUrl=function(a,c,b){return d.admin().users().addPathComponents("more-members").withParams({context:this.username,start:a,limit:c}).build()};b.prototype.init=function(){k.prototype.init.call(this);this._initBindings()};b.prototype.handleErrors=function(a){var c=this;h.each(a,function(a){c.onError(a.message)})};b.prototype.handleNewRows=function(a,c){this.$table.find("tbody")[c](bitbucket.internal.feature.user.userGroupsRows({groups:a.values}))};
b.prototype.remove=function(a){var c=this;if(k.prototype.remove.call(this,a)){var b=this.$table.find("tbody \x3e tr[data-name]").filter(function(){return f(this).attr("data-name")===a.name});b.fadeOut("fast",function(){b.remove();c.updateTimestamp()})}};b.prototype._initBindings=function(){var a=this,b=new n(f(".groups-multi-selector",a.$table),{url:d.admin().users().addPathComponents("more-non-members").withParams({context:a.username}).build()});a.$table.on("click",".add-button",function(e){e.preventDefault();
var g=b.getSelectedItems(),d=h.pluck(g,"name");a._addGroups(a.username,d).done(function(){b.clearSelectedItems();l({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.added({name:d[0],entityType:"group",count:g.length})});a.add(h.map(g,function(a){return f.extend({justAdded:!0},a)}))}).fail(function(b,c,d,g){a.handleErrors(a._extractErrors(g,d))})});a.$table.on("click",".delete-button",function(b){b.preventDefault();var c=f(b.target).closest("a").attr("data-for");a._removeGroups(a.username,
c).done(function(){a.remove({name:c});l({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.deleted({name:c,entityType:"group"})})}).fail(function(b,c,d,e){a.handleErrors(a._extractErrors(e,d))})})};b.prototype._addGroups=function(a,b){return m.rest({data:{user:a,groups:b},statusCode:{403:!1,404:!1},type:"POST",url:d.admin().users().addPathComponents("add-groups").build()})};b.prototype._removeGroups=function(a,b){return m.rest({data:{context:a,itemName:b},statusCode:{403:!1,
404:!1,409:!1},type:"POST",url:d.admin().users().addPathComponents("remove-group").build()})};b.prototype._extractErrors=function(a){return a&&a.errors&&a.errors.length?a.errors:[{message:e.escapeHtml(e.I18n.getText("bitbucket.web.user.group.unknown.error"))}]};return b});