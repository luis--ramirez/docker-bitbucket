define("bitbucket/internal/feature/user/group-users-table","aui aui/flag jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/user-multi-selector bitbucket/internal/util/ajax bitbucket/internal/util/function bitbucket/internal/widget/paged-table".split(" "),function(f,m,e,h,k,p,n,q,l){function b(a){l.call(this,e.extend({filterable:!1,noneFoundMessageHtml:f.escapeHtml(f.I18n.getText("bitbucket.web.user.group.members.none")),idForEntity:q.dot("name"),paginationContext:"group-users-table"},
a));this.group=this.$table.attr("data-group");this.$notifications=this.$table.prev(".notifications");this._initBindings=h.once(this._initBindings)}e.extend(b.prototype,l.prototype);b.prototype.init=function(){l.prototype.init.call(this);this._initBindings()};b.prototype.buildUrl=function(a,c,d){a={context:this.group,start:a,limit:c,avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:"small"})};return k.admin().groups().addPathComponents("more-members").withParams(a).build()};b.prototype.handleNewRows=
function(a,c){this.$table.find("tbody")[c](bitbucket.internal.feature.user.groupUserRows({page:a}))};b.prototype.handleErrors=function(a){var c=this.$notifications.empty();h.each(a,function(a){c.append(aui.message.error({content:f.escapeHtml(a.message)}))})};b.prototype.remove=function(a){var c=this;if(l.prototype.remove.call(this,a)){var b=this.$table.find("tbody \x3e tr[data-name]").filter(function(){return e(this).attr("data-name")===a.name});b.fadeOut("fast",function(){b.remove();c.updateTimestamp()})}};
b.prototype._initBindings=function(){var a=this,b=new p(e(".users-multi-selector",a.$table),{url:k.admin().groups().addPathComponents("more-non-members").withParams({context:a.group}).build()});a.$table.on("click",".add-button",function(d){d.preventDefault();var g=b.getSelectedItems();d=h.pluck(g,"name");a._addUsers(a.group,d).done(function(){b.clearSelectedItems();m({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.added({name:g[0].name,entityType:"user",count:g.length})});
a.add(h.map(g,function(a){return e.extend({justAdded:!0},a)}))}).fail(function(b,c,g,d){a.handleErrors(a._extractErrors(d))})});a.$table.on("click",".delete-button",function(b){b.preventDefault();var c=e(b.target).closest("a").attr("data-for");a._removeUser(a.group,c).done(function(){a.remove({name:c});m({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.deleted({name:c,entityType:"user"})})}).fail(function(b,c,e,d){a.handleErrors(a._extractErrors(d))})})};b.prototype._addUsers=
function(a,b){return n.rest({data:{group:a,users:b},statusCode:{403:!1,404:!1,500:!1},type:"POST",url:k.admin().groups().addPathComponents("add-users").build()})};b.prototype._removeUser=function(a,b){return n.rest({data:{context:a,itemName:b},statusCode:{403:!1,404:!1,409:!1,500:!1},type:"POST",url:k.admin().groups().addPathComponents("remove-user").build()})};b.prototype._extractErrors=function(a){return a&&a.errors&&a.errors.length?a.errors:[{message:f.escapeHtml(f.I18n.getText("bitbucket.web.user.group.unknown.error"))}]};
return b});