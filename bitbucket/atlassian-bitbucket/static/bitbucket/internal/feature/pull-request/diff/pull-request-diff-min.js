define("bitbucket/internal/feature/pull-request/pull-request-diff","aui chaperone jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/commit/tree-and-diff-view bitbucket/internal/feature/file-content/commit-selector bitbucket/internal/feature/pull-request/pull-request-history bitbucket/internal/layout/page-scrolling-manager bitbucket/internal/model/commit-range bitbucket/internal/model/file-content-modes bitbucket/internal/model/path-and-line bitbucket/internal/model/revision bitbucket/internal/util/events bitbucket/internal/util/history exports".split(" "),
function(d,l,m,r,e,n,z,t,A,q,B,C,u,p,v,w){var D=function(a,b){return function(){return e.rest().currentRepo().commit(a.id).comments().withParams({pullRequestId:b.getId()})}},E=function(a){return function(b){return e.rest().currentRepo().commit(b.commitRange).diff(b).withParams({pullRequestId:a.getId()})}},x=function(a){return function(b){return e.currentRepo().pullRequest(a).commit(b.id).build()}},F=function(a){return function(){return e.rest().currentRepo().pullRequest(a.getId()).comments()}},G=
function(a){return function(b){return e.rest().currentRepo().pullRequest(a.getId()).diff(b)}},y=function(a){return e.currentRepo().pullRequest(a.getId()).diff().build()},H=function(a,b,c,d){var g=void 0,h=void 0,f=void 0,k=void 0;a?(g=D(a,b),h=E(b),f="bitbucket.pull-request.commit.diff.toolbar.primary",k="bitbucket.pull-request.commit.diff.toolbar.secondary"):(g=F(b),h=G(b),f="bitbucket.pull-request.diff.toolbar.primary",k="bitbucket.pull-request.diff.toolbar.secondary");return{changesUrlBuilder:function(k,
c,d){return e.rest().currentRepo().changes(a?new q({untilRevision:d.getUntilRevision(),sinceRevision:d.getSinceRevision()}):d).withParams({start:k,limit:c,pullRequestId:b.getId()})},commentMode:n.commentMode.CREATE_NEW,commentUrlBuilder:g,diffUrlBuilder:h,linkToCommit:Boolean(a),maxChanges:c,relevantContextLines:d,toolbarWebFragmentLocationPrimary:f,toolbarWebFragmentLocationSecondary:k}},I=r.once(function(){l.registerFeature("commit-level-review",[{id:"commit-level-review",alignment:"right top",
selector:".file-tree-container .commit-selector-button",content:bitbucket.internal.feature.pullRequest.commitLevelReviewFeatureDiscoveryContent(),width:300,close:{text:d.I18n.getText("bitbucket.web.got.it")},moreInfo:{href:bitbucket_help_url("bitbucket.help.pull.request"),text:d.I18n.getText("bitbucket.web.pullrequest.learn.more"),extraAttributes:{target:"_blank"}},once:!0}]);p.on("bitbucket.internal.layout.pull-request.urlRequested",l.checkFeatureVisibility)}),c=[];w.init=function(a,b,e,l,g){var h=
this;g||I();var f=function(a){var c=void 0;a?(c=new q({pullRequest:b,untilRevision:new u(a),sinceRevision:a.parents?new u(a.parents[0]):void 0}),p.trigger("bitbucket.internal.feature.pullRequest.commitDiff.view")):c=new q({pullRequest:b});n.reset();n.init(c,H(a,b,e,l));h.commitSelector.init({updateButton:!0,selectedCommit:a,preloadItems:[{selected:!a,content:bitbucket.internal.feature.fileContent.commitSelectorAllChanges({href:y(b),message:d.I18n.getText("bitbucket.web.diff.all.changes.displayed")})}],
itemTemplate:bitbucket.internal.feature.fileContent.commitSelectorItemMessage,itemUrl:x(b),lastPageMessage:d.I18n.getText("bitbucket.web.pullrequest.diff.no.more.commits"),mode:B.DIFF,path:new C(decodeURI(window.location.hash.substring(1))),pullRequest:b})};c.push(p.chain().on("bitbucket.internal.keyboard.shortcuts.pullrequest.addCommentHandler",function(a){(this.execute?this:d.whenIType(a)).execute(function(){m(".add-file-comment-trigger:first").click()})}).on("bitbucket.internal.feature.commitselector.commitSelected",
function(a,b){var c=a?x(b)(a):y(b);v.pushState({commit:a},null,c)}).on("bitbucket.internal.history.changestate",function(a){a.state&&f(a.state.commit)}));this.commitSelector=new z({buttonEl:".file-tree-container .commit-selector-button",id:"commit-selector"});c.push(this.commitSelector);t.init();c.push({destroy:function(){return t.reset()}});c.push({destroy:function(){return n.reset()}});c.push({destroy:A.acceptScrollForwardingRequests()});v.initialState({commit:a});f(a)};w.reset=function(){var a=
m.when.apply(m,babelHelpers.toConsumableArray(r.invoke(c,"destroy")));c=[];return a};m(document).on("click",".file-tree a",function(a){a={index:this.id.match(/\d+/),keyboard:!(a.originalEvent instanceof MouseEvent)};p.trigger("bitbucket.internal.feature.pullRequest.diff.fileChange",null,a)})});