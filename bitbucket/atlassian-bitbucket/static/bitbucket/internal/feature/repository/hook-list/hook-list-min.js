define("bitbucket/internal/feature/repository/hook-list","aui backbone-brace jquery lodash bitbucket/util/navbuilder bitbucket/internal/util/ajax bitbucket/internal/util/config-form bitbucket/internal/widget/submit-spinner".split(" "),function(d,f,e,b,g,h,k,l){function c(a){(this._dialog=new d.Dialog({width:840,height:480,id:"repository-hook-dialog",closeOnOutsideClick:!1,keypressListener:b.bind(function(a){a.keyCode===d.keyCode.ESCAPE&&(a.stopImmediatePropagation(),this.close())},this)})).addHeader(" ").addPanel("",
'\x3cdiv class\x3d"hook-config-contents"/\x3e').addSubmit(d.I18n.getText("bitbucket.web.button.enable"),b.bind(this.saveHook,this)).addButton(d.I18n.getText("bitbucket.web.button.disable"),b.bind(this.disableHook,this),"button-panel-disable-button").addCancel(d.I18n.getText("bitbucket.web.button.cancel"),b.bind(this.close,this));this._hook=a;e("#repository-hook-dialog").on("submit","form",b.bind(function(a){a.preventDefault();this.saveHook()},this))}c.prototype._resize=function(){b.delay(b.bind(this._dialog.updateHeight,
this._dialog))};c.prototype._getConfigContents=function(){return this.$(".hook-config-contents")};c.prototype.saveHook=function(){var a=(new l(this.$(".button-panel-submit-button",this._dialog.getPage(0).buttonpanel),"before")).show();this._dialog.disable();this._configForm.save(this._hook.getEnabled()?b.bind(this._hook.saveSettings,this._hook):b.bind(this._hook.enable,this._hook)).done(b.bind(this.close,this)).fail(b.bind(this._resize,this)).fail(b.bind(this._dialog.enable,this._dialog)).always(b.bind(a.remove,
a))};c.prototype.disableHook=function(){this._hook.disable().always(b.bind(this.close,this))};c.prototype.$=function(a){return e("#repository-hook-dialog").find(a)};c.prototype.close=function(){this._dialog.remove();this._configForm=this._hook=null};c.prototype.show=function(){var a=this._hook;if(!a.getDetails().getConfigFormKey())throw Error("Dialog without configuration cannot be shown");this.$(".dialog-title").text(a.getDetails().getName());var c=this._getConfigContents().empty();c.spin("large");
(this._configForm=new k(c,a.getDetails().getConfigFormKey())).loadAndRender(b.bind(a.loadSettings,a)).done(b.bind(this._resize,this));this.$(".button-panel-disable-button")[a.getEnabled()?"show":"hide"]();this.$(".button-panel-submit-button").text(a.getEnabled()?d.I18n.getText("bitbucket.web.button.save"):d.I18n.getText("bitbucket.web.button.enable"));this._dialog.show();return this};return f.View.extend({initialize:function(){this.collection.on("change:enabled",b.bind(this.changeEnabledState,this));
this.currentHookPageStart=this.$("tbody \x3e tr").length;this.$loadMoreLink=this.$(".load-more");b.bindAll(this,"onHooksLoaded")},events:{"click .load-more":"loadMore","click .hook-name a":"configureHook","click .edit-button":"configureHook","click .mode-enabled":"enableHook","click .mode-disabled":"disableHook"},loadMore:function(a){a.preventDefault();this.$loadMoreLink.next(".spinner").show().spin();h.rest({url:g.rest().currentRepo().hooks().build(),type:"GET",data:{type:this.options.hookType,start:this.currentHookPageStart,
limit:25}}).done(this.onHooksLoaded)},onHooksLoaded:function(a){this.$el.children("tbody").append(bitbucket.internal.feature.repository.hookRows({values:a.values}));this.currentHookPageStart+=a.size;a.isLastPage&&this.$loadMoreLink.closest(".load-more-row").hide();this.$loadMoreLink.next(".spinner").spinStop().hide()},configureHook:function(a){a.preventDefault();a=e(a.target).closest("tr").attr("data-key");(a=this.collection.get(a))&&this.createDialog(a)},enableHook:function(a){a.preventDefault();
a=e(a.target).closest("tr").attr("data-key");a=this.collection.get(a);!a.getConfigured()&&a.getDetails().getConfigFormKey()?this.createDialog(a):this.changeEnabledStateNow(a,a.enable(),!0)},disableHook:function(a){a.preventDefault();a=e(a.target).closest("tr").attr("data-key");a=this.collection.get(a);this.changeEnabledStateNow(a,a.disable(),!1)},createDialog:function(a){(new c(a)).show()},changeEnabledStateNow:function(a,c,d){this.changeEnabledStateWithStatus(a,d);c.fail(b.bind(this.changeEnabledState,
this,a))},changeEnabledState:function(a){this.changeEnabledStateWithStatus(a,a.getEnabled())},changeEnabledStateWithStatus:function(a,b){this.$('tr[data-key\x3d"'+a.getDetails().getKey()+'"] .cell-actions').html(bitbucket.internal.feature.repository.hookActions({enabled:b}))}})});