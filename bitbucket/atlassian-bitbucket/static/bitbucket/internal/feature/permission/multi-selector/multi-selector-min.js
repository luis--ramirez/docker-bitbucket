define("bitbucket/internal/feature/permission/multi-selector","aui backbone-brace jquery lodash bitbucket/internal/feature/user/group-multi-selector bitbucket/internal/feature/user/user-multi-selector".split(" "),function(d,g,c,b,h,k){var l={user:k,group:h};return g.View.extend({events:{"click .add-button":"_onClickAdd"},initialize:function(a){var e=this.$el.find(".permission-multi-selector");this._$addButton=this.$el.find(".add-button");var f=l[a.entityType];if(!f)throw Error("Unknown entity type: "+
a.entityType);this._delegate=new f(e,{dataSource:a.dataSource});if(!b.isFunction(a.add))throw Error("must provide an add function");a=this.$el.find(".permission-type-dropdown");a.on("click","a",b.bind(this._onSelectPermission,this));this._permission=a.find("li:first-child").attr("data-value");this._delegate.on("change",b.bind(this._onChangeEntitySelection,this));this._onChangeEntitySelection();this.$el.on("keydown",b.bind(function(a){a.which===d.keyCode.ENTER&&"INPUT"===a.target.tagName&&this.getSelected().length&&
(a.preventDefault(),this._addSelected())},this))},getSelected:function(){return this._delegate.getSelectedItems()},getPermission:function(){return this._permission},showError:function(a){this.clearError();var e=this._$errors=c("\x3cdiv\x3e\x3c/div\x3e");a=a&&a.errors&&a.errors.length?a.errors:[{message:d.I18n.getText("bitbucket.web.permission.multiselector.unexpected.error")}];b.forEach(a,function(a){c('\x3cp class\x3d"error-message"\x3e\x3c/p\x3e').text(a.message).appendTo(e)});e.appendTo(this.$el.children("th"))},
clearError:function(){this._$errors&&(this._$errors.remove(),this._$errors=null)},clear:function(){this.clearError();this._delegate.clearSelectedItems();this._setAddButtonDisabled(!0)},_addSelected:function(){this._setAddButtonDisabled(!0);c.when(this.options.add({entities:this.getSelected(),permission:this.getPermission()})).always(b.bind(this._setAddButtonDisabled,this,!1)).done(b.bind(this.clear,this)).fail(b.bind(function(a,b,c,d){this.showError(d)},this))},_setAddButtonDisabled:function(a){this._$addButton.toggleClass("disabled",
a).prop("disabled",a)},_onClickAdd:function(a){a.preventDefault();this._addSelected()},_onSelectPermission:function(a){a.preventDefault();a=c(a.target);this._permission=a.closest("li").attr("data-value");this.$el.find(".permission-type-trigger").text(a.text())},_onChangeEntitySelection:function(){this._setAddButtonDisabled(!this.getSelected().length)}})});