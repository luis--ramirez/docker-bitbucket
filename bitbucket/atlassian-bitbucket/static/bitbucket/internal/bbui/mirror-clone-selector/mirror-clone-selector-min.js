define("bitbucket/internal/bbui/mirror-clone-selector/mirror-clone-selector","module exports jquery lodash bitbucket/internal/impl/urls ../widget/widget".split(" "),function(l,h,f,m,n,p){Object.defineProperty(h,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(f),e=babelHelpers.interopRequireDefault(m);babelHelpers.interopRequireDefault(n);f=function(f){function g(a,c){babelHelpers.classCallCheck(this,g);var b=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(g).call(this,
c));b.$el=(0,d.default)(a);b.availableMirrors=[];b.clicked=!1;b.loaded=!1;b.preferredMirrorId=b.options.preferredMirrorId;b.cloneProtocol=b.options.cloneProtocol;b.init();return b}babelHelpers.inherits(g,f);babelHelpers.createClass(g,[{key:"addMirror",value:function(a){if(a.available){this.availableMirrors.push(a);var c=(0,d.default)("#available-mirror-list"),b=c.find("li.mirror"),k=(0,d.default)(bitbucket.internal.component.mirroringCloneSelector.mirrorItem({item:a,extraClasses:"mirror"}));(b=e.default.find(b,
function(b){return(0,d.default)(b).text()>a.mirrorName}))?k.insertBefore(b):k.appendTo(c);this.$trigger.removeAttr("disabled");this.preferredMirrorId!==a.id||this.clicked||this.selectMirror(a.id)}}},{key:"getCloneUrl",value:function(a){return e.default.get(e.default.find(a.links.clone,"name",this.getProtocol()),"href","")}},{key:"getProtocol",value:function(){return this.cloneProtocol}},{key:"hideDropdown",value:function(){this.$dropdown.is(":visible")&&this.$trigger.trigger("aui-button-invoke")}},
{key:"init",value:function(){this.$el.html(bitbucket.internal.component.mirroringCloneSelector.main({primary:this.options.primary}));this.$trigger=this.$el.find("#available-mirrors-trigger");this.$trigger.on("click",function(a){return a.preventDefault()});this.initDropdown()}},{key:"initDropdown",value:function(){var a=this;this.$dropdown=(0,d.default)("#available-mirrors");this.$dropdown.on("click",".mirror-item",function(c){c.preventDefault();a.selectMirror((0,d.default)(c.currentTarget).data("id"));
a._updatePreferredMirror();a.clicked=!0})}},{key:"load",value:function(){var a=this;this.loaded||(this.loaded=!0,this.options.getMirrors().done(function(c){var b=[];a.preferredMirrorId&&(b=e.default.remove(c,function(b){return b.id===a.preferredMirrorId}));b.forEach(function(b){a.loadMirror(b)});c.forEach(function(b){a.loadMirror(b)})}))}},{key:"loadMirror",value:function(a){var c=this;d.default.ajax({type:"GET",contentType:"application/json",url:a.url,dataType:"json"}).done(function(b){b.id=a.id;
c.addMirror(b)})}},{key:"selectMirror",value:function(a){this.currentMirrorId=a;this.updateCloneUrl()}},{key:"showSetPushUpstream",value:function(a){var c=(0,d.default)("#update-push-url-container");a?((0,d.default)("#update-push-url-input").val("git remote set-url --push origin "+this.getCloneUrl(this.options.primary)),c.removeClass("hidden")):c.addClass("hidden")}},{key:"updateCloneProtocol",value:function(a){this.cloneProtocol=a;this.updateCloneUrl();return a}},{key:"updateCloneUrl",value:function(){var a=
void 0;this.currentMirrorId?(a=e.default.find(this.availableMirrors,"id",this.currentMirrorId),this.showSetPushUpstream(!0)):(a=this.options.primary,this.showSetPushUpstream(!1));this.currentMirrorId=a.id;this.$trigger.text(a.mirrorName);this.$trigger.css("maxWidth",this.$el.width()-this.$el.find("#clone-from-label").width()-15);this.options.updateCloneUrl(this.getProtocol(),this.getCloneUrl(a))}},{key:"show",value:function(){this.$el.show()}},{key:"hide",value:function(){this.hideDropdown();this.$el.hide()}},
{key:"_updatePreferredMirror",value:function(){this.preferredMirrorId=this.currentMirrorId;this.options.updatePreferredMirror(this.preferredMirrorId)}}]);return g}(babelHelpers.interopRequireDefault(p).default);h.default=f;f.defaults={cloneProtocol:"http",preferredMirrorId:null,updateCloneUrl:e.default.noop,updatePreferredMirror:e.default.noop,getMirrors:function(){return d.default.when([])}};l.exports=h["default"]});