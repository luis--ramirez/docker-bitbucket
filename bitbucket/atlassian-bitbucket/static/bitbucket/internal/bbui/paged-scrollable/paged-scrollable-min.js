define("bitbucket/internal/bbui/paged-scrollable/paged-scrollable","module exports jquery lodash internal/util/function internal/util/navigator ../javascript-errors/javascript-errors ../widget/widget".split(" "),function(n,f,g,p,q,r,t,u){function b(){var a=this,b=0>=arguments.length||void 0===arguments[0]?{}:arguments[0];l.default.call(this,b);if(this.options.dataProvider)this.provider=this.options.dataProvider;else throw Error("PagedScrollable must be given a DataProvider as an option `dataProvider`");
this.$scrollElement=(0,d.default)(b.scrollPaneSelector||window);d.default.isWindow(this.$scrollElement[0])&&function(){var b=window.document.documentElement;a.getPaneHeight=function(){return b.clientHeight};a.getContentHeight=function(){return b.scrollHeight}}();this._eventHandlers=[];this._page=-1;this.provider.on("reset",function(){a._page=-1;a.clear();a.loadIfRequired()})}function h(){var a=this;return this.provider.isFetching?d.default.Deferred().reject():this.provider.fetchNext().done(this.onDataLoaded).fail(function(){a.options.suspendOnFailure&&
a.suspend()})}Object.defineProperty(f,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(g),e=babelHelpers.interopRequireDefault(p),w=babelHelpers.interopRequireDefault(q);g=babelHelpers.interopRequireDefault(r);var k=babelHelpers.interopRequireDefault(t),l=babelHelpers.interopRequireDefault(u),m=g.default.isIE();b.prototype=Object.create(l.default.prototype);b.prototype.constructor=b;b.defaults={pageSize:50,scrollDelay:250,bufferPixels:0,suspendOnFailure:!0,autoLoad:!0,preventOverscroll:!1,
idForEntity:null};b.prototype.init=function(){var a=this,v=arguments,c=0>=arguments.length||void 0===arguments[0]?{}:arguments[0];b.prototype.reset.call(this);c.suspended&&this.suspend();return h.call(this).then(void 0,function(){var b=a.options.pageSize;return 0!==(c.targetedItem?Math.floor(c.targetedItem/b)*b:0)?h.call(a):d.default.Deferred().rejectWith(a,v)}).fail(function(b){b&&b.errors&&b.errors.length&&a.handleErrors(b.errors)})};b.prototype.reset=function(){this.provider.isFetching&&this.provider.abort();
this.clearListeners();this._resizeHandler&&((0,d.default)(window).off("resize",this._resizeHandler),this._resizeHandler=null);this.idForEntity=this.idForEntity||this.options.idForEntity;"function"===typeof this.idForEntity&&(this._ids={});this._suspended=!1;this._page=-1;this.clear()};b.prototype.destroy=function(){this.reset();delete this.$scrollElement};b.prototype.suspend=function(){this._suspended=!0};b.prototype.resume=function(){this._suspended=!1;return this.loadIfRequired()};b.prototype.isSuspended=
function(){return this._suspended};b.prototype.getScrollTop=function(){return this.$scrollElement.scrollTop()};b.prototype.setScrollTop=function(a){this.$scrollElement.scrollTop(a)};b.prototype.getPane=function(){return this.$scrollElement};b.prototype.getPaneHeight=function(){return this.$scrollElement[0].clientHeight};b.prototype.getContentHeight=function(){return this.$scrollElement[0].scrollHeight};b.prototype.getOption=function(a){if(Object.prototype.hasOwnProperty.call(this.options,a))return this.options[a]};
b.prototype.setOptions=function(a){d.default.isPlainObject(a)&&(this.options=d.default.extend(this.options,a))};b.prototype.addScrollListener=function(a){a=this.scrollDelay?e.default.debounce(a,this.scrollDelay):a;this._eventHandlers.push(a);this.$scrollElement.on("scroll.paged-scrollable",a)};b.prototype._bindOverscrollPrevention=function(){function a(a,b){var e=(0,d.default)(this).outerHeight();(this.scrollTop===this.scrollHeight-e&&0>b||0===this.scrollTop&&0<b)&&a.preventDefault()}this._eventHandlers.push(a);
this.$scrollElement.on("mousewheel.paged-scrollable",a)};b.prototype.clearListeners=function(){var a=this;e.default.each(this._eventHandlers,function(b){a.$scrollElement.unbind(".paged-scrollable",b)});this._eventHandlers.length=0};b.prototype.loadIfRequired=function(){if(!this.isSuspended()&&!this.provider.reachedEnd){var a=this.getScrollTop(),b=this.getPaneHeight(),c=this.getContentHeight(),a=b+a;if((d.default.isWindow(this.getPane()[0])||!this.getPane().is(":hidden"))&&e.default.any([!0,"next"],
w.default.eq(this.options.autoLoad))&&a+1>=c-this.options.bufferPixels)return this.load()}};b.prototype.load=function(){var a=this;return h.call(this).fail(function(b){b&&b.errors&&a.handleErrors(b.errors)})};b.prototype.onDataLoaded=function(a){this._page++;0<this._page&&this.trigger("pagination",{page:this._page+1});var b=void 0;m&&(b=this.getScrollTop());a=this._addPage(a);m&&this.setScrollTop(b);if(0===this._page)this.onFirstDataLoaded(a);this.loadIfRequired()};b.prototype._addPage=function(a){a=
this._dedupe(a);this.attachNewContent(a);this.trigger("page-rendered");return a};b.prototype._dedupe=function(a){var b=this;if(a&&(Array.isArray(a)&&0<a.length||Array.isArray(a.values))&&"function"===typeof this.idForEntity){var c=function(){var c=b._ids,f=function(a){a=b.idForEntity(a);return e.default.has(c,a)?!1:c[a]=!0};if(Array.isArray(a))return{v:a.filter(f)};if(Array.isArray(a.values))return a=d.default.extend({},a,{values:a.values.filter(f)}),{v:a}}();if("object"===("undefined"===typeof c?
"undefined":babelHelpers.typeof(c)))return c.v}else return a};b.prototype.onFirstDataLoaded=function(){var a=this;this.addScrollListener(function(){a.loadIfRequired()});this.options.preventOverscroll&&this._bindOverscrollPrevention();(0,d.default)(window).on("resize",this._resizeHandler=function(){a.loadIfRequired()})};b.prototype.add=function(a){return a.length?(this._addPage(a),!0):!1};b.prototype.remove=function(a){return this.options.idForEntity&&(a=this.options.idForEntity(a),e.default.has(this._ids,
a))?(delete this._ids[a],!0):!1};b.prototype.attachNewContent=function(a){throw new k.default.NotImplementedError("attachNewContent is abstract and must be implemented.");};b.prototype.handleErrors=function(a){throw new k.default.NotImplementedError("handleErrors is abstract and must be implemented.");};b.prototype.clear=function(){throw new k.default.NotImplementedError("clear is abstract and must be implemented.");};f.default=b;n.exports=f["default"]});