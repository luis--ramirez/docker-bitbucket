define("bitbucket/internal/bbui/search/internal/search","exports jquery lodash bitbucket/internal/impl/request bitbucket/internal/impl/search-urls ../../search-common/search-entities ../../search-common/search-request ../../search-common/transformer ./analytics ./search-data-provider ./search-results-table".split(" "),function(d,u,v,w,x,y,n,z,A,B,C){function D(a,l,f){q((0,n.searchFor)(l,[g.default.REPOSITORIES],{primary:f.secondary,secondary:f.secondary})).then(function(b){b=b[g.default.REPOSITORIES].values.map(z.transformRepositoryResult);
0<b.length&&(a.append(bitbucket.internal.component.search.secondaryResults({resultContent:bitbucket.internal.component.search.repositoryResults({repositories:b})})),requestAnimationFrame(function(){a.find(".primary-results-container").addClass("with-secondary-results");a.find(".secondary-results-container.loaded").removeClass("loaded")}),a.on("click",".repository-link",function(b){return r.default.repositoryResultClicked((0,t.default)(b.target).closest("li").index())}))}).fail(function(b,a,h,e){return console.warn("Repository search failed:",
m.default.get(e,"errors.0.message","??"))})}function q(a){var l=Date.now(),f=E.default.rest({type:"POST",url:F.default.searchRestUrl(),data:a,statusCode:{400:!1,500:!1}});f.then(function(b){var f=Date.now()-l,h=b.scope.repository;r.default.resultsLoaded({repository:h,project:h?h.project:b.scope.project,time:f,query:a.query,results:b})});return f}Object.defineProperty(d,"__esModule",{value:!0});d.search=q;d.createSearch=function(a,l,f){function b(){var k=e.find(".primary-results"),b=bitbucket.internal.component.search.serverError();
p&&p.suspend();k.length?k.append(b):e.html(b)}var p=void 0,h=0,e=(0,t.default)(a);e.empty();e.html(bitbucket.internal.component.search.searching());var d=e.find(".code-search-searching");d.find(".spin-container").spin();var g=function(k){var a=m.default.findKey(k,{category:"primary"}),d=k[a],a=new G.default({query:l,search:q,type:a,limits:f},k);a.on("data-request-failed",function(a){b(a)});var c=k.scope.repository;c&&m.default.has(c,"avatarUrl")&&(c.avatar_url=c.avatarUrl);var g=c?c.project:k.scope.project;
g&&m.default.has(g,"avatarUrl")&&(g.avatar_url=g.avatarUrl);c={repository:c,project:g};h=d.values.length;e.html(bitbucket.internal.component.search.codeResults({totalMatches:d.count,totalResults:d.count,loadedResults:h,scope:c}));e.on("click",".learnmore",function(){return r.default.learnMoreClicked()});p=new H.default(e.find(".primary-results"),{dataProvider:a,scope:c,querySubstituted:m.default.get(k,"query.substituted",!1)});p.init();var n=e.find(".result-load-progress");a.on("data-loaded",function(a){h+=
a.length;h>=d.count?n.hide():n.html(bitbucket.internal.component.search.resultLoadProgress({loaded:h,total:d.count}))});return p};return q((0,n.searchFor)(l,I,f)).then(function(a){"GLOBAL"===a.scope.type&&D(e,l,f);return a}).then(g).fail(function(a,d,f,c){if(a.status===J)return g(c);a.status<K?e.html(bitbucket.internal.component.search.badQuery({query:l,reason:"object"===("undefined"===typeof c?"undefined":babelHelpers.typeof(c))?m.default.get(c,"errors.0.message"):d})):b(a.responseJSON)}).always(function(){d.remove()})};
var t=babelHelpers.interopRequireDefault(u),m=babelHelpers.interopRequireDefault(v),E=babelHelpers.interopRequireDefault(w),F=babelHelpers.interopRequireDefault(x),g=babelHelpers.interopRequireDefault(y),r=babelHelpers.interopRequireDefault(A),G=babelHelpers.interopRequireDefault(B),H=babelHelpers.interopRequireDefault(C),J=200,K=500,I=[g.default.CODE]});