define("bitbucket/internal/util/time",["aui","moment","bitbucket/internal/util/text","exports"],function(d,p,q,e){function f(a,b){this.key=a;this.isAge=b}function k(a,b,c,g){return g?v(a,c,g):b===f.types.shortAge?w(a,c):x(a,c)}function w(a,b){switch(a){case "aMomentAgo":return d.I18n.getText("bitbucket.date.format.short.a.moment.ago");case "oneMinuteAgo":return d.I18n.getText("bitbucket.date.format.short.one.minute.ago");case "xMinutesAgo":return d.I18n.getText("bitbucket.date.format.short.x.minutes.ago",
b);case "oneHourAgo":return d.I18n.getText("bitbucket.date.format.short.one.hour.ago");case "xHoursAgo":return d.I18n.getText("bitbucket.date.format.short.x.hours.ago",b);case "oneDayAgo":return d.I18n.getText("bitbucket.date.format.short.one.day.ago");case "xDaysAgo":return d.I18n.getText("bitbucket.date.format.short.x.days.ago",b);case "oneWeekAgo":return d.I18n.getText("bitbucket.date.format.short.one.week.ago");default:return null}}function x(a,b){switch(a){case "aMomentAgo":return d.I18n.getText("bitbucket.date.format.long.a.moment.ago");
case "oneMinuteAgo":return d.I18n.getText("bitbucket.date.format.long.one.minute.ago");case "xMinutesAgo":return d.I18n.getText("bitbucket.date.format.long.x.minutes.ago",b);case "oneHourAgo":return d.I18n.getText("bitbucket.date.format.long.one.hour.ago");case "xHoursAgo":return d.I18n.getText("bitbucket.date.format.long.x.hours.ago",b);case "oneDayAgo":return d.I18n.getText("bitbucket.date.format.long.one.day.ago");case "xDaysAgo":return d.I18n.getText("bitbucket.date.format.long.x.days.ago",b);
case "oneWeekAgo":return d.I18n.getText("bitbucket.date.format.long.one.week.ago");default:return null}}function v(a,b,c){switch(a){case "aMomentAgo":return c.aMomentAgo(b);case "oneMinuteAgo":return c.oneMinuteAgo(b);case "xMinutesAgo":return c.xMinutesAgo(b);case "oneHourAgo":return c.oneHourAgo(b);case "xHoursAgo":return c.xHoursAgo(b);case "oneDayAgo":return c.oneDayAgo(b);case "xDaysAgo":return c.xDaysAgo(b);case "oneWeekAgo":return c.oneWeekAgo(b);default:return null}}function y(a){if(z.call(m,
a))return m[a];var b="",c;for(r.exec("");c=r.exec(a);)switch(c=c[0],c.charAt(0)){case "'":b+="["+c.substring(1,c.length-1)+"]";break;case "d":case "y":case "a":b+=c.toUpperCase();break;default:b+=c}return m[a]=b}function A(a){switch(a.key){case "short":case "shortAge":return date_format("bitbucket.date.format.short");case "long":case "longAge":return date_format("bitbucket.date.format.long");case "full":return date_format("bitbucket.date.format.full");case "timestamp":return date_format("bitbucket.date.format.timestamp");
default:return null}}function B(a,b){var c=a.clone(),g="number"===typeof b?b:e.getTimezoneOffset();a.zone()!==g&&c.add("m",a.zone()-g);return c}function n(a,b,c){var g="number"===typeof c?c:e.getTimezoneOffset();a=B(a,g);b=y(A(b)).replace(/Z+/g,function(a){a=1===a.length?"":":";var b="number"===typeof g?g:e.getTimezoneOffset(),c=Math.abs(b),d=Math.floor(c/60),c=c%60,b=""+(0>=b?"+":"-")+q.padLeft(d.toString(),2,"0"),b=b+(a||""),b=b+q.padLeft(c.toString(),2,"0");return"["+b+"]"});return a.format(b)}
function t(a,b,c,d){c=c||p();if(a<=c){if(a>c.clone().subtract("m",1))return k("aMomentAgo",b,null,d);if(a>c.clone().subtract("m",2))return k("oneMinuteAgo",b,null,d);if(a>c.clone().subtract("m",50))return k("xMinutesAgo",b,Math.floor(c.diff(a,"minutes",!0)),d);if(a>c.clone().subtract("m",90))return k("oneHourAgo",b,null,d);for(var f=c,h=f.clone().add("d",1).hours(0).minutes(0).seconds(0).milliseconds(0).subtract("m",a.zone()-e.getTimezoneOffset());h>f;)h.subtract("d",1);if(h.clone().subtract("d",
1)<=a&&a<h&&a<c.clone().subtract("h",5))return k("oneDayAgo",b,null,d);if(a>c.clone().subtract("d",1))return a=c.diff(a,"hours",!0),a=Math.round(a),k("xHoursAgo",b,a,d);if(a>c.clone().subtract("d",7))return k("xDaysAgo",b,Math.max(Math.floor(c.diff(a,"days",!0)),2),d);if(a>c.clone().subtract("d",8))return k("oneWeekAgo",b,null,d)}return n(a,b)}var z=Object.prototype.hasOwnProperty,m={},r=/d{1,2}|'[^']+'|M{1,4}|y{2,4}|h{1,2}|H{1,2}|m{2}|s{2}|S{1,4}|Z{1,2}|z{1,2}|a|:|-|\/|\s+/g;f.types={};var u="shortAge longAge short long full timestamp".split(" "),
C=u.length,h,l;for(h=0;h<C;h++)l=u[h],f.types[l]=new f(l,-1!==l.toLowerCase().indexOf("age"));e.format=function(a,b,c){a=a?p(a):null;b=f.types[b];c=a&&b?b.isAge?t(a,b,null,c):n(a,b):null;return c};e.formatDateWithFormatString=n;e.formatDateWithRelativeAge=t;e.FormatType=f;e.getTimezoneOffset=function(){var a=document.getElementById("content");return a?parseInt(a.getAttribute("data-timezone"),10):0}});