define("bitbucket/internal/util/oauth",["jquery","bitbucket/internal/util/events"],function(e,d){function h(a){var c=new e.Deferred,b={url:a,deferred:c,api:c.promise({abort:function(){f.cancelRequest(a)}})};d.trigger("bitbucket.internal.util.oauth.authorizationRequested",null,a);c.then(function(){d.trigger("bitbucket.internal.util.oauth.authorizationSucceeded",null,a)},function(){d.trigger("bitbucket.internal.util.oauth.authorizationFailed",null,a)});f.fireRequest(a,c.resolve,c.reject);return b}function g(a){if(b){if(b.url===
a)return b.api;b.api.abort()}a=b=h(a);b.deferred.always(function(){b=null});return a.api}var f=function(){function a(){window.aouthWindow&&window.aouthWindow.close&&window.aouthWindow.close();window.oauthCallback=null;window.aouthWindow=null}return{fireRequest:function(c,b,d){window.oauthCallback={uri:c,success:function(){a();b&&b()},failure:function(){a();d&&d()}};window.aouthWindow=window.open(c)},cancelRequest:function(a){window.oauthCallback&&window.oauthCallback.uri===a&&window.oauthCallback.failure()}}}(),
b;return{authorizeUrl:g,interceptLinks:function(a){e(document).on("click",a,function(a){var b=this.getAttribute("href");b&&(g(b),a.preventDefault())})}}});