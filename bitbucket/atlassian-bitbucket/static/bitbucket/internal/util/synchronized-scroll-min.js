define("bitbucket/internal/util/synchronized-scroll","lodash bitbucket/internal/model/direction bitbucket/internal/util/function bitbucket/internal/util/math bitbucket/internal/util/performance exports".split(" "),function(f,l,n,u,E,m){function k(a){if(a instanceof k)return a;if(!(this instanceof k))return new k(a);this._el=a;this._programmatic=!1;return this}function g(a,b){if(!(this instanceof g))return new g(a,b);this._el=b;this._parentScrollable=a;if(!this._parentScrollable._el)throw Error("Regions can't (yet) be created for custom Scrollables. We would need to solve the API problem of where to put a function to get the offset relative to the top of the scrollable.");
return this}function w(a,b){return b}function x(a,b){return a.scrollHeight-a.clientHeight-b}function y(a){return a.scrollHeight-a.clientHeight-a.scrollTop}function F(a,b,c,d,e,h){var z=b.scrollTop!==a.scrollTop,k=b.scrollLeft!==a.scrollLeft;c=f.filter(c,function(a){return z&&a.canScrollVertically||k&&a.canScrollHorizontally});if(!c.length)return[];if(!z)return f.map(c,function(a){return v(a,null,b.scrollLeft)});var q=b.scrollTop>a.scrollTop?l.DOWN:l.UP,r=c.concat(b),p=f.filter(r,n.dot("canScrollVertically")),
m=n.binary(Math.max),r=f.chain(p).pluck("topness").reduce(m,0).value()*(q===l.UP?1:0),p=f.chain(p).pluck("bottomness").reduce(m,0).value()*(q===l.UP?0:1),g=G(r*r,p*p,q),p=g[1],r=g[2];d=0<g[0]?H(h,b,c,d,e):[];e=0<p?f.map(c,q===l.UP?A(a,b,B,w):C(a,b,B,w)):[];a=0<r?f.map(c,q===l.DOWN?A(a,b,y,x):C(a,b,y,x)):[];return f.chain(c).zip(f.zip(d,e,a)).map(n.spread(function(a,c){var d=a.scrollLeft!==b.scrollLeft;if(!a.canScrollVertically)return v(a,null,d&&a.canScrollHorizontally?b.scrollLeft:null);var h=c.map(n.defaultValue(0)).map(u.clamp(0,
a.scrollHeight)),h=f.chain(f.zip(h,g)).map(I).reduce(u.add,0).value(),e=0<(q===l.UP?-1:1)*(h-a.scrollTop);return e||d?v(a,e?h:null,d?b.scrollLeft:null):null})).filter(f.identity).value()}function G(a,b,c){var d=Math.max(a,b),e=Math.min(a,b),h=(1-d)*e/(1+e);a=a>b||a===b&&c===l.UP;return[(1-d)/(1+e),a?d:h,a?h:d]}function v(a,b,c){return{scrollable:a.scrollable,scrollTop:b,scrollLeft:c}}function A(a,b,c,d){a=Math.max(c(a),1);var e=(a-c(b))/a;return function(a){var b=Math.max(c(a),1),b=b-e*b;1>b&&(b=
0);return d(a,b)}}function C(a,b,c,d){a=c(a);var e=c(b)-a;return function(a){var b=c(a)+e;return d(a,b)}}function H(a,b,c,d,e){var h=b.clientHeight*a;b=d(b.scrollable);var g=J(h,b);b=c.map(function(a){return a.canScrollVertically?D(e(g.region,a.scrollable)):null});var k=Math.max(0,Math.min(1,(g.offsetTop+g.height-h)/g.height));return f.zip(b,c).map(n.spread(function(b,c){return c.canScrollVertically?Math.max(0,c.scrollTop+b.offsetTop-(k*b.height+c.clientHeight*a-b.height)):null}))}function J(a,b){var c;
f.some(b,function(b){b=D(b);var e=b.offsetTop,h=b.height;return a>e&&a<=e+h?(c=b,!0):!1});return c}function D(a){return{region:a,offsetTop:a.getOffsetTop(),height:a.getHeight()}}function t(a){var b=a.getScrollInfo(),b={scrollable:a,clientWidth:b.clientWidth,clientHeight:b.clientHeight,scrollWidth:b.width,scrollHeight:b.height,scrollTop:b.top,scrollLeft:b.left,canScrollHorizontally:b.clientWidth<b.width,canScrollVertically:b.clientHeight<b.height};a=b.clientHeight/2;b.topness=a?Math.max(0,(a-b.scrollTop)/
a):0;b.bottomness=a?Math.max(0,1-(b.scrollHeight-(b.scrollTop+b.clientHeight))/a):0;return b}var I=n.spread(u.multiply);k.prototype.getScrollInfo=function(){return{top:this._el.scrollTop,left:this._el.scrollLeft,width:this._el.scrollWidth,height:this._el.scrollHeight,clientWidth:this._el.clientWidth,clientHeight:this._el.clientHeight}};k.prototype.scrollTo=function(a,b){null!=b&&(this._programmatic=!0,this._el.scrollTop=b);null!=a&&(this._programmatic=!0,this._el.scrollLeft=a)};k.prototype.getAndUnsetProgrammaticScrollMarker=
function(){var a=this._programmatic;this._programmatic=!1;return a};g.prototype.getHeight=function(){return this._el.offsetHeight};g.prototype.getOffsetTop=function(){return this._el.getBoundingClientRect().top-this._parentScrollable._el.getBoundingClientRect().top};var B=n.dot("scrollTop");m.createScrollable=k;m.createRegion=g;m.getScrollHandler=function(a){a=f.extend({},m.getScrollHandler.defaults,a);var b=t(a.self),c,d=E.enqueueCapped(requestAnimationFrame,function(){var e=t(a.self),d=f.map(a.others,
t),d=F(c,e,d,a.getRegions,a.getLinkedRegion,a.focusHeightFraction);b=e;d.length&&a.executeCommands(d)});return{handle:function(){a.self.getAndUnsetProgrammaticScrollMarker()?b=t(a.self):(c=b,d())},reset:function(){b=t(a.self)}}};m.getScrollHandler.defaults={self:null,others:null,getRegions:null,getLinkedRegion:null,focusHeightFraction:.5,executeCommands:function(a){f.forEach(a,function(a){a.scrollable.scrollTo(a.scrollLeft,a.scrollTop)})}}});