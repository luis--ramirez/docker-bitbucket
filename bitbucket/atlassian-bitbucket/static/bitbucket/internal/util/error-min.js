define("bitbucket/internal/util/error","aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/model/page-state bitbucket/internal/util/function bitbucket/internal/util/navigator exports".split(" "),function(d,h,n,t,m,u,y,g){function f(a,b,e,c,d){this._out={title:a,message:b,details:e,context:c,level:d||g.level.ERROR,fallbackUrl:void 0,fallbackTitle:void 0,shouldLogin:!1,shouldReload:!1,canRetry:!1,shouldRetry:!1,retryAfterDate:void 0}}function v(a,b,e,c){var k;if(k=401===b||200<=b&&400>b)k=
null==e||null==c?(e||null)===(c||null):null!=e.id&&null!=c.id?e.id===c.id:e.name===c.name,k=!k;if(k){if(401===b)a=(new f).doAccessDenied(null!=e);else if((k=e)||(k=!(204===b&&y.isIE()&&!a.getAllResponseHeaders())),k)a=(new f)[e?"shouldReload":"shouldLogin"]();else return null;return c?e?401===b?a.message(d.I18n.getText("bitbucket.web.error.logged.in.as.other.and.denied",'"'+c.name+'"','"'+e.name+'"')).build():a.title(d.I18n.getText("bitbucket.web.error.user.changed.title")).message(d.I18n.getText("bitbucket.web.error.logged.in.as.other",
'"'+c.name+'"','"'+e.name+'"')).build():a.title(d.I18n.getText("bitbucket.web.error.logged.out.title")).message(d.I18n.getText("bitbucket.web.error.logged.out")).build():401===b?a.message(d.I18n.getText("bitbucket.web.error.logged.in.and.denied",'"'+e.name+'"')).build():a.title(d.I18n.getText("bitbucket.web.error.logged.in.title")).message(d.I18n.getText("bitbucket.web.error.logged.in",'"'+e.name+'"')).build()}return null}function w(a){var b=a.getResponseHeader("X-AUSERID");a=a.getResponseHeader("X-AUSERNAME");
return null!=a?{id:null!=b?parseInt(b,10):null,name:decodeURIComponent(a)}:null}var p=!1,x=0;h(document).ready(function(){p=!0;var a=window.onbeforeunload;window.onbeforeunload=function(){p=!1;return a?a.apply(this,arguments):void 0}}).on("keydown",function(a){a.keyCode===d.keyCode.ESCAPE&&(x=(new Date).getTime())});g.showNonFieldErrors=function(a){var b=h("#content \x3e header \x3e .notifications").empty();"string"===typeof a?q(b,a):a&&a.length?(a=n.filter(a,u.not(u.pluck("context"))),a.length&&
n.each(a,function(a){q(b,a&&a.message?a.message:a)})):q(b,d.I18n.getText("bitbucket.web.unknownerror"))};var q=function(a,b){h(aui.message.error({content:d.escapeHtml(b)})).appendTo(a)};g.isErrorEntityWithinRepository=function(a){return a&&/branch|tag|repository object|commit|revision|comment/i.test(a.message)};g.level={INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS"};f.prototype.title=function(a){this._out.title=a;return this};f.prototype.message=function(a){this._out.message=a;return this};
f.prototype.details=function(a){this._out.details=a;return this};f.prototype.context=function(a){this._out.context=a;return this};f.prototype.level=function(a){this._out.level=a||g.level.ERROR;return this};f.prototype.shouldLogin=function(){this._out.shouldLogin=!0;return this};f.prototype.shouldReload=function(){this._out.shouldReload=!0;return this};f.prototype.shouldRetry=function(){this._out.shouldRetry=!0;return this.canRetry()};f.prototype.canRetry=function(){this._out.canRetry=!0;return this};
f.prototype.fallbackUrl=function(a,b){this._out.fallbackUrl=a;this._out.fallbackTitle=b;return this};f.prototype.retryAfterDate=function(a){this._out.retryAfterDate=isNaN(a)?void 0:a;this._out.retryAfterDate&&this.shouldRetry();return this};f.prototype.doAccessDenied=function(a){this.title(this._out.title||l["401"]);a?(this.message(this._out.message||d.I18n.getText("bitbucket.web.error.no.permission")),this.fallbackUrl(t.allProjects().build(),d.I18n.getText("bitbucket.web.ajax.back.to.projects"))):
(this.message(this._out.message||d.I18n.getText("bitbucket.web.error.anonymous.disallowed")),this.shouldLogin());return this};f.prototype.doServerDown=function(){this.title(this._out.title||l["0"]);this.message(this._out.message||r["0"]);this.canRetry();return this};f.prototype.doRequestThrottled=function(a){this.title(this._out.title||l["503"]);this.message(this._out.message||r["503"]);this.canRetry();this.retryAfterDate(isNaN(Number(a))?new Date(Date.parse(a)):new Date((new Date).getTime()+1E3*
Number(a)));return this};f.prototype.doNotFound=function(a,b){this.title(this._out.title||l["404"]);this.message(this._out.message||r["404"]);this.fallbackUrl(a||this._out.fallbackUrl||t.allProjects().build(),b||this._out.fallbackTitle||d.I18n.getText("bitbucket.web.ajax.back.to.projects"));return this};f.prototype.build=function(){this._out.title||this.title(d.I18n.getText("bitbucket.web.dialog.ajax.error.title"));return this._out};var l={401:d.I18n.getText("bitbucket.web.dialog.ajax.error.not.permitted.title"),
404:d.I18n.getText("bitbucket.web.couldnt.find.title"),502:d.I18n.getText("bitbucket.web.server.unreachable.title"),0:d.I18n.getText("bitbucket.web.server.unreachable.title"),503:d.I18n.getText("bitbucket.web.server.busy.title")},r={404:d.I18n.getText("bitbucket.web.couldnt.find"),502:d.I18n.getText("bitbucket.web.error.server.unresponsive"),0:d.I18n.getText("bitbucket.web.error.server.unresponsive"),503:d.I18n.getText("bitbucket.web.error.too.much.load")};g.getDominantAJAXError=function(a,b,e){var c=
Number(a.status);e=void 0!==e?e:m.getCurrentUser()?m.getCurrentUser().toJSON():null;b=void 0!==b?b:w(a);if(b=v(a,c,b,e))return b;if(0===c||400<=c&&600>c)switch(c){case 401:return(new f).doAccessDenied(!!e).build();case 404:return(new f).doNotFound().build();case 0:if(p&&"abort"!==a.statusText&&100<(new Date).getTime()-x)return(new f).doServerDown().build();break;case 502:return(new f).doServerDown().build();case 503:return(new f).doRequestThrottled(a.getResponseHeader("Retry-After")).build();default:return(new f(null,
d.I18n.getText("bitbucket.web.we.screwed.up"))).shouldReload().build()}return null};g.getDominantRESTError=function(a,b){var e,c,d;d=m.getCurrentUser()?m.getCurrentUser().toJSON():null;if(b){e=Number(b.status);c=w(b);var h=v(b,e,c,d);if(h)return h}if(a&&a.errors&&a.errors.length){c=a.errors[0];c=new f(c.title||l[e],c.message,c.details,c.context,c.level||g.level.ERROR);switch(e){case 401:c.doAccessDenied(null!=d);break;case 404:c.doNotFound();break;case 409:c.shouldReload();break;case 503:c.doRequestThrottled(b.getResponseHeader("Retry-After"))}return c.build()}return b?
g.getDominantAJAXError(b,c,d):null};g.setFormErrors=function(a,b){var e=h(a);g.clearFormErrors(e);var c=n.chain(b).filter(function(a){if(!a.message)return!1;if(a.context){var b=e.find('[name\x3d"'+a.context+'"]').closest(".field-group");if(b.length)return h(document.createElement("div")).addClass("error").text(a.message).appendTo(b),!1}return!0}).pluck("message").map(d.escapeHtml).value().join("\x3cbr\x3e");c&&e.prepend(aui.message.error({content:c}))};g.clearFormErrors=function(a){h(a).find(".error").remove()}});