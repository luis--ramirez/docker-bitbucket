define("bitbucket/internal/util/html",["aui","bitbucket/internal/util/function","exports"],function(A,y,k){function u(){}function w(b,a,c){c=c||"string";return"function"===typeof b?b:y.constant(("undefined"===typeof b?"undefined":babelHelpers.typeof(b))===c?b:a)}function v(){this._backing=[]}var x=window.console&&console.error?function(){console.error.apply(console,arguments)}:A.log,n={OPEN:"open",CLOSE:"close"};u.prototype.next=function(){x("NodeStream.next is abstract and must be implemented")};
u.prototype.getNextType=function(){x("NodeStream.getNextType is abstract and must be implemented")};u.prototype.getNextTextPosition=function(){x("NodeStream.getNextTextPosition is abstract and must be implemented")};var B=/<\s*(\w+)(?=\s|>)/;v.prototype.pushAtPriority=function(b,a){(this._backing[a]||(this._backing[a]=[])).push(b)};v.prototype.popAtPriority=function(b){return(this._backing[b]||(this._backing[b]=[])).pop()};v.prototype.popPrioritiesAbove=function(b){var a=[],c=this._backing;for(b+=
1;c.length>b;){var d=this._backing.pop();if(d)for(var e=d.length-1;0<=e;e--)a.push(d[e])}return a};v.prototype.peek=function(){for(var b=this._backing.length;b--;)if(this._backing[b]&&this._backing[b].length)return this._backing[b][this._backing[b].length-1]};var z=document.createElement("div");k.quickNDirtyAttach=function(b,a,c){if("html"!==c&&b.hasChildNodes()){z.innerHTML=a;a=document.createDocumentFragment();for(var d=z.childNodes.length;d--;)a.appendChild(z.childNodes[0]);"append"===c?b.appendChild(a):
b.insertBefore(a,b.firstChild)}else b.innerHTML=a};k.NodeStream=u;k.NodeType=n;k.htmlNodeStream=function(b,a){function c(){if(!l&&null!=d){l=!0;var a=b.indexOf("\x3c",d);a!==d&&(-1===a?e=d=null:(e+=g(b.substring(d,a)).length,d=a))}}var d=0,e=0,q=b.length,h,l,g=a||function(b){x("Not yet implemented")},f=new u,p=[];f.getNextType=function(){var a;(a=h)||(c(),a=null==d?null:"/"===b[d+1]?n.CLOSE:n.OPEN,a=h=a);return a};f.next=function(){c();if(null==d)return null;var a=this.getNextType(),f=b.indexOf("\x3e",
d),f=-1===f?q:f+1,g=b.substring(d,f),t={type:a,value:g,textPosition:e};a===n.OPEN&&(t.close={type:n.CLOSE,value:"\x3c/"+g.match(B)[1]+"\x3e"},p.push(e));d=f;h=null;l=!1;return t};f.getNextTextPosition=function(){c();return e};return f};k.lineNodeStream=function(b,a,c){c=c||{};var d=0,e=0,q=b.length,h=n.OPEN,l=w(c.lineStart,""),g=w(c.lineEnd,"\x3cbr /\x3e"),f=w(c.emptyLine,""),p=w(c.lineOffset,1,"number"),m,r;a=a||y.dot("text");var k={open:function(){h=n.CLOSE;var c=a(b[d],d).length;r={type:n.CLOSE,
value:c?g(b[d],d):f(b[d],d)+g(b[d],d)};m={type:n.OPEN,value:l(b[d],d),close:r,textPosition:e};e=e+c+p(b[d],d);return m},close:function(){d++;r.textPosition=e;h=n.OPEN;m=null;return r}};c=new u;c.getNextType=function(){return d>=q?null:h};c.next=function(){return d>=q?null:k[h]()};c.getNextTextPosition=function(){return d>=q?null:e};return c};k.mergeStreams=function(b){for(var a,c,d=Array.prototype.slice.call(arguments,1),e=0,q=new v,h=[],l,g="";;){a=d;var f=void 0,p=Infinity;c={getNextTextPosition:y.constant(null)};
for(var m=void 0,r=a.length,m=0;m<r;m++){var k=a[m],t=k.getNextTextPosition();null!=t&&t<p?(c=k,p=t,f=m):t===p&&k.getNextType()===n.CLOSE&&(c=k,f=m)}a=f;f=c;c=f.getNextTextPosition();m=(p=null==c)||c>e;if(h.length&&(m||a>=l)){for(l=h.length-1;0<=l;l--)r=h[l],g+=r.tag.value,q.pushAtPriority(r,r.streamIndex);h=[];l=null}m&&(g+=A.escapeHtml(b.substring(e,c||void 0)));if(p)return g;e=f.next();if(null!=e){e.type===n.CLOSE?q.popAtPriority(a):q.pushAtPriority({streamIndex:a,tag:e},a);a=q.popPrioritiesAbove(a);
if(a.length){l=a[0].streamIndex;p=a.length;for(f=0;f<p;f++)g+=a[f].tag.close.value;h.push.apply(h,a)}g+=e.value}e=c}};k.sanitizeId=function(b){return b.replace(/:/g,"\\:").replace(/\./g,"\\.")}});