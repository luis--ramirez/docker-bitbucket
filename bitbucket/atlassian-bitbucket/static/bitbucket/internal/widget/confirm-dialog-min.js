define("bitbucket/internal/widget/confirm-dialog",["aui","jquery","lodash","bitbucket/internal/util/ajax","bitbucket/internal/widget/submit-spinner"],function(e,d,l,q,r){function a(b,t){this.dialogOptions=d.extend({},a.dialogDefaults,b);this.ajaxOptions=t||{};this._selectors=[];this._okCallbacks=d.Callbacks();this._cancelCallback=d.Callbacks();this._detachers=d.Callbacks();this._attached=!1}a.prototype.getConfirmButton=function(){return d("#"+this.dialogOptions.id+" ."+this.dialogOptions.confirmButtonClass)};
a.prototype.getButtons=function(){var b=this.getConfirmButton(),a=this.dialogOptions.id;l.each(this._selectors,function(e){b=b.add(d("#"+a+" "+e))});return b};a.prototype.setButtonsDisabled=function(b){this.getButtons().each(function(){var a=d(this);a.prop("disabled",b).toggleClass("disabled",b);b?a.attr("aria-disabled","true"):a.removeAttr("aria-disabled")})};a.prototype.destroy=function(){this._detachers.fire();this._detachers=null};a.prototype.attachTo=function(b,a,m){var g=this,c=this.dialogOptions,
l=this.ajaxOptions,u=this._okCallbacks,v=this._cancelCallback;m=m||document;var f=d(m);this._selectors.push(b);var n=function(){g.setButtonsDisabled(!1)};f.on("hideLayer",n);var p=function(b){b.preventDefault();var k=d(this);if(!k.is(":disabled")){var f=function(a){g.setButtonsDisabled(!1);a.remove()},h=new e.Dialog({width:c.width,height:c.height,id:c.id,focusSelector:c.focusSelector,closeOnOutsideClick:!1,keypressListener:function(a){a.stopImmediatePropagation();a.keyCode===e.keyCode.ENTER?(a.preventDefault(),
g.getConfirmButton().click()):a.keyCode===e.keyCode.ESCAPE&&(a.preventDefault(),f(h))}});h.addHeader(c.titleText,c.titleClass);h.addPanel("",c.panelContent,c.panelClass);h.addButton(c.submitText,function(a){g.setButtonsDisabled(!0);var b=null,c=new r(g.getConfirmButton(),"before");g.dialogOptions.submitToHref&&(c.show(),"A"===k[0].tagName?b=q.rest(d.extend({url:k.attr("href")},l)).always(function(){c.hide();f(a)}):k.closest("form")[0].submit());u.fire(b,k,function(){f(a)},a,c)},"button "+(c.confirmButtonClass||
""));h.addCancel(e.I18n.getText("bitbucket.web.button.cancel"),function(a){f(a);v.fire(k)});a&&a(this,h,g);h.show();g._attached=!0}};f.on("click",b,p);this._detachers.add(function(){f.off("hideLayer",n);f.off("click",b,p)})};a.prototype.addConfirmListener=function(a){this._okCallbacks.add(a)};a.prototype.addCancelListener=function(a){this._cancelCallback.add(a)};a.dialogDefaults={id:void 0,titleText:e.I18n.getText("bitbucket.web.title.confirm"),titleClass:"confirm-header",confirmButtonClass:"confirm-button",
panelContent:"\x3cp\x3e"+e.I18n.getText("bitbucket.web.dialog.confirm")+"\x3c/p\x3e",panelClass:"panel-body",submitText:e.I18n.getText("bitbucket.web.button.confirm"),submitToHref:!0,height:230,width:433,focusSelector:".confirm-button"};return a});