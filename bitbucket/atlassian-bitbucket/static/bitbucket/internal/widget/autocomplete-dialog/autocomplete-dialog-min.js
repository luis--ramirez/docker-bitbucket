define("bitbucket/internal/widget/autocomplete-dialog",["backbone","jquery","lodash"],function(e,d,f){return e.View.extend({className:"aui-dropdown2 aui-style-default aui-dropdown2-tailed",initialize:function(){var a=parseInt(this.options.minZIndex,10);a&&this.$el.css("z-index",a+1);d(document.body).append(this.el);this.options.anchor&&this.updateAnchorPosition(this.options.anchor);this.template=this.options.template||d.noop;this.highlighter=this.options.highlighter;this.collection=this.collection||
new e.Collection;this.collection.bind("reset",this.render,this);this.render()},events:{"click li.result":"onClickItem"},render:function(){var a=this.collection.toJSON(),c=this.collection.query,b=this.collection.indexOf(this.selectedResult),b=d(this.template({query:c,results:a,activeItemIndex:0<=b?b:0}));c&&a.length&&f.isFunction(this.highlighter)&&(b=this.highlighter(b,c));this.$el.html(b);this.$spinner&&this.$spinner.appendTo(this.$("ul"));return this},toggleSpinner:function(a){a?this.$spinner||
(this.$spinner=d("\x3cli/\x3e").addClass("spinContainer").appendTo(this.$("ul")).spin("small")):(this.$spinner&&this.$spinner.spinStop().remove(),this.$spinner=null)},moveSelectionUp:function(){this.moveSelection(this.DIRECTION_UP)},moveSelectionDown:function(){this.moveSelection(this.DIRECTION_DOWN)},moveSelection:function(a){var c=this.$("li");if(!(1>=c.length)){var b=c.filter(".active"),b=d.inArray(b.get(0),c);if(a===this.DIRECTION_DOWN?b<c.length-1:0<b)b+=a,c.removeClass("active").eq(b).addClass("active"),
this.selectedResult=this.collection.at(b)}},getSelectedItemIndex:function(){return this.$("li.active").index()},onClickItem:function(a){this.trigger("itemSelected",this.$(a.currentTarget).index())},anchorOptions:{dropdownTailBufferLeft:25,dropdownTailBufferRight:35,viewportWidth:d(window).width(),bufferTop:2},updateAnchorPosition:function(a){this.anchorOptions.viewportWidth-a.left>this.$el.outerWidth()?this.$el.css({top:a.top+this.anchorOptions.bufferTop,left:a.left-this.anchorOptions.dropdownTailBufferLeft}).attr("data-dropdown2-alignment",
"left"):this.$el.css({top:a.top+this.anchorOptions.bufferTop,left:a.left-this.$el.outerWidth()+this.anchorOptions.dropdownTailBufferRight}).attr("data-dropdown2-alignment","right")},DIRECTION_UP:-1,DIRECTION_DOWN:1})});