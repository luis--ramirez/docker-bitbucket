define("bitbucket/internal/widget/canvas-cropper",["jquery","bitbucket/internal/util/feature-detect"],function(p,q){function a(b,c){if(!a.isSupported())throw Error("This browser doesn't support CanvasCropper.");return this.init.apply(this,arguments)}a.isSupported=q.canvas;a.prototype.defaults={outputFormat:"image/png",backgroundFillColor:void 0};a.prototype.init=function(b,c,n){this.width=b;this.height=c||b;this.options=p.extend({},this.defaults,n);this.canvas=p("\x3ccanvas/\x3e").attr("width",this.width).attr("height",
this.height).get(0);return this};a.prototype.cropToDataURI=function(b,c,n,a,d){return this.crop(b,c,n,a,d).getDataURI(this.options.outputFormat)};a.prototype.crop=function(b,c,a,g,d){var k=this.canvas.getContext("2d"),l=0,m=0,e=this.width,f=this.height;k.clearRect(l,m,e,f);this.options.backgroundFillColor&&(k.fillStyle=this.options.backgroundFillColor,k.fillRect(l,m,e,f));0>c&&(l=Math.round(Math.abs(c)/g*e),c=0);0>a&&(m=Math.round(Math.abs(a)/d*f),a=0);if(c+g>b.naturalWidth){var h=b.naturalWidth-
c,e=h/g*e;g=h}a+d>b.naturalHeight&&(h=b.naturalHeight-a,f*=h/d,d=h);k.drawImage(b,c,a,g,d,l,m,e,f);return this};a.prototype.getDataURI=function(a){return a?this.canvas.toDataURL(a):null};return a});