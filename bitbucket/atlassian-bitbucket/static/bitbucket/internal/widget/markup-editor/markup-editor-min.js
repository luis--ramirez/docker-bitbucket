define("bitbucket/internal/widget/markup-editor","aui jquery lodash bitbucket/internal/util/async-element-resize-helper bitbucket/internal/util/events bitbucket/internal/widget/markup-attachments bitbucket/internal/widget/markup-preview bitbucket/internal/widget/mentionable-textarea".split(" "),function(k,f,c,l,g,h,m,n){function b(a){this.init.apply(this,arguments)}var d=[];b._dataKey="markup-editor";b.bindTo=function(a){a=b.unbindFrom(a);var e=new b(a);a.data(b._dataKey,e);return e};b.unbindFrom=
function(a){a=f(a);a=a.is(".markup-editor")?a:a.find(".markup-editor");var e=a.data(b._dataKey);e&&e.destroy();return a};b.registerExtension=function(a){c.contains(d,a)||d.push(a)};b.deregisterExtension=function(a){d=c.without(d,a)};g.addLocalEventMixin(b.prototype);b.prototype.init=function(a){a=f(a);this.$editor=a.is(".markup-editor")?a:a.find(".markup-editor");this._destroyables=[];a=this.$editor.find("textarea");a.is(document.activeElement)&&c.defer(a.focus.bind(a));a=this.$editor.find("textarea.expanding").expandingTextarea();
this._destroyables.push(g.chainWith(a).on("resize.expanding",this.onComponentResize.bind(this,!1)));this._destroyables.push({destroy:a.expandingTextarea.bind(a,"destroy")});a=new m(this.$editor);this._destroyables.push(g.chainWith(a).on("resize",this.onComponentResize.bind(this,!0)));this._destroyables.push(a);this._destroyables.push(new n({$container:this.$editor}));a=function(a){this.$editor.find(".markup-attachments-button").addClass("disabled").prop("disabled","disabled").attr("aria-disabled",
!0).attr("title",a)}.bind(this);h.isEnabled()?h.isSupported()?this._destroyables.push(new h(this.$editor)):a(k.I18n.getText("bitbucket.web.markup.attachments.unsupported")):a(k.I18n.getText("bitbucket.web.markup.attachments.disabled"));d.forEach(function(a){a.init(this.$editor);c.isFunction(a.destroy)&&this._destroyables.push({destroy:c.partial(a.destroy,this.$editor)})}.bind(this));this.$editor.find(".markup-preview-help").tooltip({gravity:f.fn.tipsy.autoNS})};b.prototype.onComponentResize=function(a){var b=
this;l(this.$editor[0],function(){b.$editor.triggerHandler("resize");b.trigger("resize",a)})};b.prototype.destroy=function(){c.invoke(this._destroyables,"destroy");this.$editor.data(b._dataKey,null);this.$editor=null;this.off()};return b});