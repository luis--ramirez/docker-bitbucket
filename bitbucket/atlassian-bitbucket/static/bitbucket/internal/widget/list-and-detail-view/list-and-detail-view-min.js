define("bitbucket/internal/widget/list-and-detail-view",["jquery","lodash","bitbucket/internal/util/feature-detect"],function(d,e,f){function b(a,c,g){this.options=d.extend({},b.prototype.defaults,g);this.$listView=a.find(".list-view");this.$detailView=a.find(".detail-view");this.selectHandler=c;e.bindAll(this,"_itemClickHandler","_shortcutHandler");this.init()}b.prototype.defaults={selectedClass:"selectedItem"};b.prototype.init=function(){this.bindShortcuts();this.$listView.on("click","li",this._itemClickHandler);
this._maybeSelectFirst()};b.prototype._itemClickHandler=function(a){var c=this.options.selectedClass;this.$listView.find("li."+c).removeClass(c);c=d(a.currentTarget).addClass(c);this.selectHandler(c,this.$listView,this.$detailView,a)};b.prototype._maybeSelectFirst=function(){this.options.selectFirstOnInit&&this.$listView.find("li:first").click()};b.prototype.destroy=function(){this.unbindShortcuts()};b.prototype._shortcutHandler=function(a){if(74===a.which)a="next";else if(75===a.which)a="prev";else return;
this.$listView.find("li."+this.options.selectedClass)[a]("li").click().find("a").focus().blur()};b.prototype.bindShortcuts=function(){d(document).on("keydown",this._shortcutHandler)};b.prototype.unbindShortcuts=function(){d(document).off("keydown",this._shortcutHandler)};b.prototype.removeItem=function(a,c){var b=d.Deferred();a.addClass("offScreen").one(f.transitionEndEventName(),function(c){a.remove();b.resolve()});a.next(c).length?a.next(c).click():a.prev(c).length?a.prev(c).click():this.$detailView.empty();
return b.promise()};b.prototype.addItem=function(a,c,b){a.addClass("offScreen");c?a.insertBefore(c):a.appendTo(this.$listView);a.offset();a.removeClass("offScreen");b&&a.click()};return b});