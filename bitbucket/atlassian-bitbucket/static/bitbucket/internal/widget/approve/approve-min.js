define("bitbucket/internal/widget/approve","aui jquery bitbucket/internal/model/page-state bitbucket/internal/util/ajax bitbucket/internal/util/events bitbucket/internal/widget/button-trigger bitbucket/internal/widget/keyboard-shortcuts".split(" "),function(g,f,c,m,d,h,l){function k(a,f){this._opts={url:f,triggerHandler:this.buttonClicked};h.call(this,a,this._opts);var e=this,b=function(a){c.getCurrentUser()&&a.user.name===c.getCurrentUser().getName()&&a.pullRequestId===c.getPullRequest().getId()&&
(e.setTriggerActive(a.approved),a=a.approved?g.I18n.getText("bitbucket.web.pullrequest.toolbar.approved.tooltip"):g.I18n.getText("bitbucket.web.pullrequest.toolbar.approve.tooltip"),e._$trigger.attr("title",a),l.addTooltip(e._$trigger,"a"))};d.on("bitbucket.internal.widget.approve-button.adding",b);d.on("bitbucket.internal.widget.approve-button.removing",b);d.on("bitbucket.internal.widget.approve-button.add.failed",b);d.on("bitbucket.internal.widget.approve-button.remove.failed",b);l.addTooltip(e._$trigger,
"a")}f.extend(k.prototype,h.prototype);k.prototype.buttonClicked=function(a,k,e){function b(a,b){d.trigger(a,h,f.extend({approved:b,pullRequestId:c.getPullRequest().getId(),user:c.getCurrentUser().toJSON()},e))}var h=this;b(a?"bitbucket.internal.widget.approve-button.adding":"bitbucket.internal.widget.approve-button.removing",a);m.rest({url:h._opts.url,type:a?"POST":"DELETE",statusCode:{401:function(a,b,e,c,d){return f.extend({},d,{title:g.I18n.getText("bitbucket.web.pullrequest.approve.error.401.title"),
message:g.I18n.getText("bitbucket.web.pullrequest.approve.error.401.message"),fallbackUrl:!1,shouldReload:!0})},409:function(a,b,d,e,c){return f.extend({},c,{title:g.I18n.getText("bitbucket.web.pullrequest.approve.error.409.title"),fallbackUrl:!1,shouldReload:!0})}}}).done(function(){b(a?"bitbucket.internal.widget.approve-button.added":"bitbucket.internal.widget.approve-button.removed",a)}).fail(function(){b(a?"bitbucket.internal.widget.approve-button.add.failed":"bitbucket.internal.widget.approve-button.remove.failed",
!a)})};return k});