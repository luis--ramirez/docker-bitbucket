define("bitbucket/internal/widget/keyboard-shortcuts","aui jquery lodash bitbucket/internal/util/events bitbucket/internal/util/navigator exports".split(" "),function(b,g,d,m,q,f){function c(){if(!(this instanceof c))return new c;this._enabledContexts=[]}function n(a,b){a=g.extend({},a);a.keys=d.map(a.keys,function(a){return d.map(a,function(a){if(d.all(["key","modifiers"],d.partial(d.has,a)))return a;var h=1<a.length?a.split("+"):a;return d.isArray(h)&&1!==h.length?{key:h.pop(),modifiers:b&&!1===
b.convertOSModifier?h:d.map(h,c.convertOSModifier)}:a})});a.displayContext||(a.displayContext=c._contextDisplayInfo[a.context]?c._contextDisplayInfo[a.context].displayName:a.context.replace(/\b[a-z]/g,function(a){return a.toUpperCase()}));k[a.displayContext]||(k[a.displayContext]=[]);k[a.displayContext].push(a)}function p(a,b){m.trigger("bitbucket.internal.ui.keyboard.shortcutClicked",null,{context:a,keyEventName:b})}var r=/^[cC]trl$/i,l,k={};c.prototype._setRegistry=function(a){this._registry=a};
c.prototype._initContent=function(){this._dialog=b.dialog2(aui.dialog.dialog2({titleText:b.I18n.getText("bitbucket.web.keyboardshortcut.header"),content:bitbucket.internal.widget.keyboardShortcutsContent({contextNames:d.keys(k),contexts:d.values(k)}),size:"large",id:"keyboard-shortcut-dialog"}))};c.prototype._bind=function(a){this._$trigger=a;var b=this;this._$trigger.on("click",function(a){a.preventDefault();b._show()})};c.prototype.enableContext=function(a){-1===g.inArray(a,this._enabledContexts)&&
(l=a,this._registry.enableContext(a),l=void 0,this._enabledContexts.push(a))};c.prototype.resetContexts=function(){b.trigger("remove-bindings.keyboardshortcuts");this._enabledContexts=[];b.trigger("add-bindings.keyboardshortcuts")};c.prototype._show=function(){this._hasShown||(this._initContent(),this._hasShown=!0);this._dialog.show()};c.prototype.addCustomShortcut=function(a,b,c,d){n({keys:b,context:a,displayContext:d,description:c},{convertOSModifier:!1})};c.convertOSModifier=function(a){return q.isMac()?
a.replace(r,"\u2318"):a};c.internalizeShortcuts=function(a){d.each(a,n)};c._contextDisplayInfo={repository:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.repository")},"branch-compare":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.branch-compare")},"branch-list":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.branch-list")},commit:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.commit")},commits:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.commits")},
"diff-tree":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.diff-tree")},"diff-view":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.diff-view")},filebrowser:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.filebrowser")},global:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.global")},"pull-request":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request")},"pull-request-list":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request-list")},
"pull-request-overview":{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request")},sourceview:{displayName:b.I18n.getText("bitbucket.web.keyboardshortcut.context.sourceview")}};var e=new c;f.onReady=function(){e._bind(g(".keyboard-shortcut-link"));var a=g.Deferred();g(document).ready(function(){setTimeout(function(){a.resolve()},0)});b.bind("register-contexts.keyboardshortcuts",function(b,c){e._setRegistry(c.shortcutRegistry);e.enableContext("global");a.done(function(){m.trigger("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",
e,e)})});b.bind("shortcuts-loaded.keyboardshortcuts",function(a,b){c.internalizeShortcuts(b.shortcuts)});b.params["keyboardshortcut-hash"]="bundled";b.trigger("initialize.keyboardshortcuts");require("bitbucket/internal/util/shortcuts").bind("keyboardShortcutsDialog",e._show.bind(e))};f.addTooltip=function(a,e){var f=d(e.split("+")).chain().map(c.convertOSModifier).map(function(a){return"shift"===a?b.I18n.getText("bitbucket.web.keyboardshortcut.key.shift"):"ctrl"===a?c.convertOSModifier(b.I18n.getText("bitbucket.web.keyboardshortcut.key.ctrl")):
a}).value().join(" + "),g=a.attr("title");a.attr("title",g+b.I18n.getText("bitbucket.web.keyboardshortcut.type",f));return{remove:function(){a.attr("title",g)}}};f.bindKeyboardShortcutAnalytics=function(a,b){b.onValue(p.bind(null,l,a))};f.fireKeyboardShocutAnalyticsEvent=p;f.getEnablingContext=function(){return l};f.showDialog=function(){e&&e._show()};f.resetContexts=function(){e.resetContexts()}});