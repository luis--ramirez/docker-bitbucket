require(["aui","jquery","bitbucket/util/navbuilder","bitbucket/util/server"],function(h,c,e,k){function f(a){var b=a.substring(0,a.substring(750).search(/\s/)+750);return b.length<a.length?b+"\u2026":b}function l(a){"in"===a.data("tipsy").hoverState&&(a.tipsy("hide"),a.tipsy("show"))}var g={};c(function(){c("a.commitid:not(.no-preview), .commit-preview-trigger").tipsy({live:!0,opacity:.98,gravity:function(){return c.fn.tipsy.autoNS.call(this)+c.fn.tipsy.autoWE.call(this)},className:"commit-preview-tipsy",
title:function(){var a=c(this),b=a.data("commit-message");if(b)return f(b);var d=a.attr("data-commitid")||a.text();if(g.hasOwnProperty(d))return g[d];if(b=e.parse(a.attr("href")).path().match(/.*?\/(projects|users)\/([^\/]+)\/repos\/([^\/]+)\//))var m=("users"===b[1]?"~":"")+b[2],b=e.rest().project(m).repo(b[3]).commit(d).build();else b=e.rest().currentRepo().commit(d).build();k.rest({url:b,statusCode:{404:function(a,b,c,e,f){g[d]=f.message;return!1}}}).done(function(a){g[d]=f(a.message)}).always(l.bind(null,
a));return h.I18n.getText("bitbucket.web.commit.preview.loading")}})})});