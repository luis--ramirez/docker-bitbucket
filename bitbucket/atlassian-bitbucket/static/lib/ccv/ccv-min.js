if(void 0===parallable){var parallable=function(e,m){parallable.core[m.toString()]=m().core;return function(){var g,c,f,l;if(1<arguments.length)for(c=arguments[arguments.length-2],f=arguments[arguments.length-1],l=Array(arguments.length-2),g=0;g<arguments.length-2;g++)l[g]=arguments[g];else c=arguments[0].async,f=arguments[0].worker,l=arguments[0],delete l.async,delete l.worker,l=[l];var h={shared:{}},d=m.apply(h,l);return c?function(K,b){var G=0,a=Array(f),k=d.pre.apply(h,[f]);for(g in h.shared)"function"==
typeof h.shared[g]?delete h.shared[g]:void 0!==h.shared[g].tagName&&delete h.shared[g];for(g=0;g<f;g++){var c=new Worker(e);c.onmessage=function(b){return function(l){a[b]="string"==typeof l.data?JSON.parse(l.data):l.data;G++;G==f&&K(d.post.apply(h,[a]))}}(g);var H={input:k[g],name:m.toString(),shared:h.shared,id:g,worker:l.worker_num};try{c.postMessage(H)}catch(n){c.postMessage(JSON.stringify(H))}}}:d.post.apply(h,[[d.core.apply(h,[d.pre.apply(h,[1])[0],0,1])]])}};parallable.core={}}
function get_named_arguments(e,m){if(1<e.length){for(var g={},c=0;c<m.length;c++)g[m[c]]=e[c];return g}return 1==e.length?e[0]:{}}
var ccv={pre:function(e){if("img"==e.tagName.toLowerCase()){var m=document.createElement("canvas");document.body.appendChild(e);m.width=e.offsetWidth;m.style.width=e.offsetWidth.toString()+"px";m.height=e.offsetHeight;m.style.height=e.offsetHeight.toString()+"px";document.body.removeChild(e);m.getContext("2d").drawImage(e,0,0);return m}return e},grayscale:function(e){for(var m=e.getContext("2d"),g=m.getImageData(0,0,e.width,e.height),c=g.data,f,l,h=e.width*e.height*4;0<h;)c[h-=4]=c[f=h+1]=c[l=h+2]=
.3*c[h]+.59*c[f]+.11*c[l];m.putImageData(g,0,0);return e},array_group:function(e,m){var g,c,f=Array(e.length);for(g=0;g<e.length;g++)f[g]={parent:-1,element:e[g],rank:0};for(g=0;g<e.length;g++)if(f[g].element){for(var l=g;-1!=f[l].parent;)l=f[l].parent;for(c=0;c<e.length;c++)if(g!=c&&f[c].element&&m(f[g].element,f[c].element)){for(var h=c;-1!=f[h].parent;)h=f[h].parent;if(h!=l){f[l].rank>f[h].rank?f[h].parent=l:(f[l].parent=h,f[l].rank==f[h].rank&&f[h].rank++,l=h);for(var d=c;-1!=f[d].parent;)h=d,
d=f[d].parent,f[h].parent=l;for(d=g;-1!=f[d].parent;)h=d,d=f[d].parent,f[h].parent=l}}}l=Array(e.length);for(g=h=0;g<e.length;g++){c=-1;d=g;if(f[d].element){for(;-1!=f[d].parent;)d=f[d].parent;0<=f[d].rank&&(f[d].rank=~h++);c=~f[d].rank}l[g]=c}return{index:l,cat:h}},detect_objects:parallable("ccv.js",function(e,m,g,c){if(void 0!==this.shared){var f=get_named_arguments(arguments,["canvas","cascade","interval","min_neighbors"]);this.shared.canvas=f.canvas;this.shared.interval=f.interval;this.shared.min_neighbors=
f.min_neighbors;this.shared.cascade=f.cascade;this.shared.scale=Math.pow(2,1/(f.interval+1));this.shared.next=f.interval+1;this.shared.scale_upto=Math.floor(Math.log(Math.min(f.canvas.width/f.cascade.width,f.canvas.height/f.cascade.height))/Math.log(this.shared.scale));for(f=0;f<this.shared.cascade.stage_classifier.length;f++)this.shared.cascade.stage_classifier[f].orig_feature=this.shared.cascade.stage_classifier[f].feature}return{pre:function(l){l=this.shared.interval;var h=this.shared.scale,d=
this.shared.next,f=this.shared.scale_upto,b=Array(4*(f+2*d)),e=Array(4*(f+2*d));b[0]=this.shared.canvas;e[0]={width:b[0].width,height:b[0].height,data:b[0].getContext("2d").getImageData(0,0,b[0].width,b[0].height).data};var a;for(a=1;a<=l;a++)b[4*a]=document.createElement("canvas"),b[4*a].width=Math.floor(b[0].width/Math.pow(h,a)),b[4*a].height=Math.floor(b[0].height/Math.pow(h,a)),b[4*a].getContext("2d").drawImage(b[0],0,0,b[0].width,b[0].height,0,0,b[4*a].width,b[4*a].height),e[4*a]={width:b[4*
a].width,height:b[4*a].height,data:b[4*a].getContext("2d").getImageData(0,0,b[4*a].width,b[4*a].height).data};for(a=d;a<f+2*d;a++)b[4*a]=document.createElement("canvas"),b[4*a].width=Math.floor(b[4*a-4*d].width/2),b[4*a].height=Math.floor(b[4*a-4*d].height/2),b[4*a].getContext("2d").drawImage(b[4*a-4*d],0,0,b[4*a-4*d].width,b[4*a-4*d].height,0,0,b[4*a].width,b[4*a].height),e[4*a]={width:b[4*a].width,height:b[4*a].height,data:b[4*a].getContext("2d").getImageData(0,0,b[4*a].width,b[4*a].height).data};
for(a=2*d;a<f+2*d;a++)b[4*a+1]=document.createElement("canvas"),b[4*a+1].width=Math.floor(b[4*a-4*d].width/2),b[4*a+1].height=Math.floor(b[4*a-4*d].height/2),b[4*a+1].getContext("2d").drawImage(b[4*a-4*d],1,0,b[4*a-4*d].width-1,b[4*a-4*d].height,0,0,b[4*a+1].width-2,b[4*a+1].height),e[4*a+1]={width:b[4*a+1].width,height:b[4*a+1].height,data:b[4*a+1].getContext("2d").getImageData(0,0,b[4*a+1].width,b[4*a+1].height).data},b[4*a+2]=document.createElement("canvas"),b[4*a+2].width=Math.floor(b[4*a-4*d].width/
2),b[4*a+2].height=Math.floor(b[4*a-4*d].height/2),b[4*a+2].getContext("2d").drawImage(b[4*a-4*d],0,1,b[4*a-4*d].width,b[4*a-4*d].height-1,0,0,b[4*a+2].width,b[4*a+2].height-2),e[4*a+2]={width:b[4*a+2].width,height:b[4*a+2].height,data:b[4*a+2].getContext("2d").getImageData(0,0,b[4*a+2].width,b[4*a+2].height).data},b[4*a+3]=document.createElement("canvas"),b[4*a+3].width=Math.floor(b[4*a-4*d].width/2),b[4*a+3].height=Math.floor(b[4*a-4*d].height/2),b[4*a+3].getContext("2d").drawImage(b[4*a-4*d],1,
1,b[4*a-4*d].width-1,b[4*a-4*d].height-1,0,0,b[4*a+3].width-2,b[4*a+3].height-2),e[4*a+3]={width:b[4*a+3].width,height:b[4*a+3].height,data:b[4*a+3].getContext("2d").getImageData(0,0,b[4*a+3].width,b[4*a+3].height).data};return[e]},core:function(l,h,d){h=this.shared.cascade;d=this.shared.scale;var f=this.shared.next,b=this.shared.scale_upto,e,a,k,g,c,n,m=1,w=1,B=[0,1,0,1],C=[0,0,1,1],I=[];for(e=0;e<b;e++){var x=l[4*e+8*f].width-Math.floor(h.width/4),L=l[4*e+8*f].height-Math.floor(h.height/4);g=[4*
l[4*e].width,4*l[4*e+4*f].width,4*l[4*e+8*f].width];var D=[16*l[4*e].width-16*x,8*l[4*e+4*f].width-8*x,4*l[4*e+8*f].width-4*x];for(a=0;a<h.stage_classifier.length;a++){c=h.stage_classifier[a].orig_feature;var u=h.stage_classifier[a].feature=Array(h.stage_classifier[a].count);for(k=0;k<h.stage_classifier[a].count;k++)for(u[k]={size:c[k].size,px:Array(c[k].size),pz:Array(c[k].size),nx:Array(c[k].size),nz:Array(c[k].size)},n=0;n<c[k].size;n++)u[k].px[n]=4*c[k].px[n]+c[k].py[n]*g[c[k].pz[n]],u[k].pz[n]=
c[k].pz[n],u[k].nx[n]=4*c[k].nx[n]+c[k].ny[n]*g[c[k].nz[n]],u[k].nz[n]=c[k].nz[n]}for(n=0;4>n;n++){var y=[l[4*e].data,l[4*e+4*f].data,l[4*e+8*f+n].data],p=[8*B[n]+C[n]*l[4*e].width*8,4*B[n]+C[n]*l[4*e+4*f].width*4,0];for(c=0;c<L;c++){for(g=0;g<x;g++){var v=0,J=!0;for(a=0;a<h.stage_classifier.length;a++){var v=0,E=h.stage_classifier[a].alpha,u=h.stage_classifier[a].feature;for(k=0;k<h.stage_classifier[a].count;k++){var q=u[k],t,z=y[q.pz[0]][p[q.pz[0]]+q.px[0]],A=y[q.nz[0]][p[q.nz[0]]+q.nx[0]];if(z<=
A)v+=E[2*k];else{var r,F=!0;for(r=0;r<q.size;r++){if(0<=q.pz[r]&&(t=y[q.pz[r]][p[q.pz[r]]+q.px[r]],t<z)){if(t<=A){F=!1;break}z=t}if(0<=q.nz[r]&&(t=y[q.nz[r]][p[q.nz[r]]+q.nx[r]],t>A)){if(z<=t){F=!1;break}A=t}}v+=F?E[2*k+1]:E[2*k]}}if(v<h.stage_classifier[a].threshold){J=!1;break}}J&&I.push({x:(4*g+2*B[n])*m,y:(4*c+2*C[n])*w,width:h.width*m,height:h.height*w,neighbor:1,confidence:v});p[0]+=16;p[1]+=8;p[2]+=4}p[0]+=D[0];p[1]+=D[1];p[2]+=D[2]}}m*=d;w*=d}return I},post:function(e){var f=this.shared.min_neighbors,
d=this.shared.cascade,c;for(c=0;c<d.stage_classifier.length;c++)d.stage_classifier[c].feature=d.stage_classifier[c].orig_feature;e=e[0];if(0<f){c=ccv.array_group(e,function(a,b){var c=Math.floor(.25*a.width+.5);return b.x<=a.x+c&&b.x>=a.x-c&&b.y<=a.y+c&&b.y>=a.y-c&&b.width<=Math.floor(1.5*a.width+.5)&&Math.floor(1.5*b.width+.5)>=a.width});var b=c.cat,g=c.index,a=Array(b+1);for(c=0;c<a.length;c++)a[c]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(c=0;c<e.length;c++){var d=e[c],k=g[c];0==
a[k].neighbors&&(a[k].confidence=d.confidence);++a[k].neighbors;a[k].x+=d.x;a[k].y+=d.y;a[k].width+=d.width;a[k].height+=d.height;a[k].confidence=Math.max(a[k].confidence,d.confidence)}e=[];for(c=0;c<b;c++)d=a[c].neighbors,d>=f&&e.push({x:(2*a[c].x+d)/(2*d),y:(2*a[c].y+d)/(2*d),width:(2*a[c].width+d)/(2*d),height:(2*a[c].height+d)/(2*d),neighbors:a[c].neighbors,confidence:a[c].confidence});b=[];for(c=0;c<e.length;c++){d=e[c];a=!0;for(f=0;f<e.length;f++)if(g=e[f],k=Math.floor(.25*g.width+.5),c!=f&&
d.x>=g.x-k&&d.y>=g.y-k&&d.x+d.width<=g.x+g.width+k&&d.y+d.height<=g.y+g.height+k&&(g.neighbors>Math.max(3,d.neighbors)||3>d.neighbors)){a=!1;break}a&&b.push(d)}return b}return e}}})};onmessage=function(e){e="string"==typeof e.data?JSON.parse(e.data):e.data;e=parallable.core[e.name].apply({shared:e.shared},[e.input,e.id,e.worker]);try{postMessage(e)}catch(m){postMessage(JSON.stringify(e))}};