(function(f){"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],f):f(CodeMirror)})(function(f){function n(a){this.options={};for(var c in g)this.options[c]=(a&&a.hasOwnProperty(c)?a:g)[c];this.matchesonscroll=this.overlay=this.timeout=null}function h(a){var c=a.state.matchHighlighter;clearTimeout(c.timeout);c.timeout=setTimeout(function(){k(a)},
c.options.delay)}function l(a,c,d,b){var e=a.state.matchHighlighter;a.addOverlay(e.overlay=p(c,d,b));e.options.annotateScrollbar&&a.showMatchesOnScrollbar&&(e.matchesonscroll=a.showMatchesOnScrollbar(d?new RegExp("\\b"+c+"\\b"):c,!0,{className:"CodeMirror-selection-highlight-scrollbar"}))}function m(a){var c=a.state.matchHighlighter;c.overlay&&(a.removeOverlay(c.overlay),c.overlay=null,c.matchesonscroll&&(c.matchesonscroll.clear(),c.matchesonscroll=null))}function k(a){a.operation(function(){var c=
a.state.matchHighlighter;m(a);if(!a.somethingSelected()&&c.options.showToken){for(var d=!0===c.options.showToken?/[\w$]/:c.options.showToken,b=a.getCursor(),e=a.getLine(b.line),f=b=b.ch;b&&d.test(e.charAt(b-1));)--b;for(;f<e.length&&d.test(e.charAt(f));)++f;b<f&&l(a,e.slice(b,f),d,c.options.style)}else if(d=a.getCursor("from"),e=a.getCursor("to"),d.line==e.line){if(b=c.options.wordsOnly){a:if(null!==a.getRange(d,e).match(/^\w+$/)){if(0<d.ch&&(b={line:d.line,ch:d.ch-1},b=a.getRange(b,d),null===b.match(/\W/))){b=
!1;break a}if(e.ch<a.getLine(d.line).length&&(b={line:e.line,ch:e.ch+1},b=a.getRange(e,b),null===b.match(/\W/))){b=!1;break a}b=!0}else b=!1;b=!b}b||(d=a.getRange(d,e),c.options.trim&&(d=d.replace(/^\s+|\s+$/g,"")),d.length>=c.options.minChars&&l(a,d,!1,c.options.style))}})}function p(a,c,d){return{token:function(b){var e;if(e=b.match(a))(e=!c)||(e=(!b.start||!c.test(b.string.charAt(b.start-1)))&&(b.pos==b.string.length||!c.test(b.string.charAt(b.pos))));if(e)return d;b.next();b.skipTo(a.charAt(0))||
b.skipToEnd()}}}var g={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};f.defineOption("highlightSelectionMatches",!1,function(a,c,d){d&&d!=f.Init&&(m(a),clearTimeout(a.state.matchHighlighter.timeout),a.state.matchHighlighter=null,a.off("cursorActivity",h));c&&(a.state.matchHighlighter=new n(c),k(a),a.on("cursorActivity",h))})});